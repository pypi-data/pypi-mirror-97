{#
# Copyright (C) 2020 Cinc
#
# All rights reserved.
#
# License: 3-clause BSD
#}

# extends 'admin.html'
<!DOCTYPE html>
<html>
<head>
    <title>
      # block admintitle
      ${_("Manage Projects")}
      # endblock admintitle
    </title>
    # block head
    ${ super() }
    <script type="text/javascript">
    {# script taken and modified from milestone_edit_form.html Trac 1.2
     #}
        jQuery(document).ready(function($) {
          function updateCompletedDate() {
            var checked = $("#completed").checked();
            $("#completeddate").enable(checked);
          }
          $("#completed").click(updateCompletedDate);
          updateCompletedDate();
        });
    </script>
    # endblock head
</head>
<body>
    # block adminpanel
    <h2>${_("Manage Projects")}
    # if view != 'detail':
        <span class="trac-count">(${len(all_projects)})</span>
    # endif
    </h2>
    <div>
        # if view == 'detail':
        <form class="mod" id="edit" method="post" action="">
            <div>
                <input class="" name="old_name" value="${project.name}" type="hidden"/>
                <input class="" name="project_id" value="${project.id}" type="hidden"/>
            </div>
            ${jmacros.form_token_input()}
            <fieldset>
                <legend>${_("Modify Project:")}</legend>
                <div class="field">
                    <label>${_("Name:")}
                        <br/>
                        <input class="trac-autofocus" name="name" size="32" value="${project.name}"
                               type="text" id="name"/>
                    </label>
                </div>
                <div class="field">
                    <label>${_("Summary:")}
                        <br />
                        <input type="text" name="summary" size="52" value="${project.summary}"/>
                    </label>
                </div>
                <div class="field description">
                    <label for="description">
                        Description: (you may use <a tabindex="42" href="${href.wiki('WikiFormatting')}">WikiFormatting</a> here)
                    </label>
                    <div>
                        <textarea id="description" class="wikitext trac-fullwidth trac-resizable" name="description"
                                  rows="10" cols="50">${project.description}</textarea>
                    </div>
                </div>
                <div class="field">
                    <label>
                        <input type="checkbox" name="restricted" value="restricted"
                               ${{"checked": project.restricted}|htmlattr} />
                        ${_("Restrict Project")}
                    </label>
                    <p class="help">${_("Select this if you want to restrict this project and associated data to specific users or groups.")}<br/>
                    ${_("Users can be associated with this project using the 'Permissions' panel.")}
                        ${_('Permission for this project is "PROJECT_%s_MEMBER".') % project.id}</p>
                </div>

                <div class="field">
                    <label>
                        <input type="checkbox" id="completed" name="completed" value="completed"
                               ${{"checked": project.closed}|htmlattr}/>
                        ${_("Mark as completed")}<br />
                    </label>
                    <label class="disabled">
                        <input type="text" id="completeddate" name="completeddate" class="trac-datetimepicker"
                               size="${len(datetime_hint) + 2}"
                               title="${_('Format: %(datehint)s', datehint=datetime_hint)}"
                               disabled=""
                               value="${format_datetime(project.closed if project.closed else None)}"/>
                        <span class="trac-datetimehint">${_("Format:")} ${datetime_hint}</span>
                    </label>
                </div>
                # if 'PROJECT_ADMIN' in perm:
                <div class="buttons">
                    <input class="trac-disable-on-submit" type="submit" name="save" value="${_('Submit changes')}"/>
                    <input type="submit" name="cancel" value="${_('Cancel')}"/>
                </div>
                # endif
            </fieldset>
        </form>

        # else:
        {# Main page
         #}

        # if not custom_field:
        <div class="system-message warning">${_("Ticket custom field 'project' not configured. See installation instructions.")}</div>
        # endif

        # if 'PROJECT_ADMIN' in perm:
        <form class="mod" id="addproject" method="post" action="">
            ${jmacros.form_token_input()}
            <fieldset>
                <legend>${_("Add Project:")}</legend>
                <div class="field">
                    <label>${_("Name:")}
                        <br/>
                        <input type="text" name="name" value="${name}"/>
                    </label>
                </div>
                <div class="field">
                    <label>${_("Summary:")}
                        <br />
                        <input type="text" name="summary" size="52" value="${summary}"/>
                    </label>
                </div>
                <div class="field">
                    <label>
                        ${_("Description:")}
                        <br />
                        <div>
                            <textarea class="trac-resizable" name="description"
                                      rows="3" cols="50">${description}</textarea>
                        </div>
                    </label>
                </div>
                <div class="field">
                    <label>
                        <input type="checkbox" name="restricted" value="restricted"
                               ${{"checked": restricted}|htmlattr}/>
                        ${_("Restrict Project")}
                    </label>
                    <p class="help">${_("Select this if you want to restrict this project and associated data to specific users or groups.")}<br/>
                    ${_("Users can be associated with this project using the 'Permissions' panel.")}</p>
                </div>
                <div>
                    <div class="buttons">
                        <input type="submit" name="add" value="${_('Add')}"/>
                    </div>
                </div>
            </fieldset>
        </form>

        # endif

         <form id="project_table" method="post" action="">
            ${jmacros.form_token_input()}
            <table class="listing" id="projectlist">
                <thead>
                    <tr>
                        <th class="sel">&nbsp;</th>
                        <th>${_("ID")}</th>
                        <th>${_("Name")}</th>
                        <th>${_("Summary")}</th>
                        <th>${_("Completed")}</th>
                        <th>${_("Is restricted")}</th>
                    </tr>
                </thead>
                <tbody>
                # for prj in all_projects:
                    <tr>
                        <td>
                            # if 'PROJECT_ADMIN' in perm:
                            <input type="checkbox" name="sel" value="${prj.id}"/>
                            # endif
                        </td>

                        <td class="project_id">
                            <a href="${href.admin('projects', 'projects', prj[1])}">${prj.id}</a>
                        </td>
                        <td class="name">
                            <a href="${href.admin('projects', 'projects', prj[1])}">${prj.name}</a>
                        </td>
                        <td class="summary">
                            ${prj.summary}
                        </td>
                        <td class="completed">
                            ${format_datetime(prj.closed if prj.closed else None) if prj.closed else ''}
                        </td>
                        <td class="restricted">
                        # if prj.restricted:
                            <div>Yes
                            <p class="help">Use permission PROJECT_${prj.id}_MEMBER to assign users to the project.</p>
                            </div>
                        # endif
                        </td>
                    </tr>
                # endfor
                </tbody>
            </table>
            # if 'PROJECT_ADMIN' in perm:
            <div class="buttons">
                   <input type="submit" name="remove"
                        value="${_('Remove selected items')}"/>
            </div>
            # endif
        </form>

        # endif
    </div>
    # endblock adminpanel
</body>
</html>