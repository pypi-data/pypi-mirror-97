<!--!
 (c) Cinc 2015-2020, License 3-clause BSD
 -->
<div xmlns="http://www.w3.org/1999/xhtml"
    xmlns:py="http://genshi.edgewall.org/"
    xmlns:i18n="http://genshi.edgewall.org/i18n"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    class="projects">

  <div py:if="ms_without_prj and milestones" class="milestone">
    <div class="smp-project-group">
      <div class="info">
          <h2>Milestones without a Project</h2>
      </div>
      <div class="smp-grouped-ms">
        <py:for each="idx, milestone in enumerate(milestones)">
            <div py:if="not milestone.id_project" class="milestone">
              <div class="info trac-progress" py:with="mstats = milestone_stats[idx]">
                <h3><a href="${href.milestone(milestone.name)}">
                  Milestone: <em>${milestone.name}</em>
                </a></h3>
                <py:choose>
                  <p py:when="milestone.completed" class="date">
                    <i18n:msg params="duration, date">
                      Completed ${dateinfo(milestone.completed)} ago (${format_datetime(milestone.completed)})
                    </i18n:msg>
                  </p>
                  <p py:when="milestone.is_late" class="date">
                    <i18n:msg params="duration, date">
                      <strong>${dateinfo(milestone.due)} late</strong> (${format_datetime(milestone.due)})
                    </i18n:msg>
                  </p>
                  <p py:when="milestone.due" class="date">
                    <i18n:msg params="duration, date">
                      Due in ${dateinfo(milestone.due)} (${format_datetime(milestone.due)})
                    </i18n:msg>
                  </p>
                  <p py:otherwise="" class="date">
                    No date set
                  </p>
                </py:choose>
                <xi:include href="progress_bar.html" py:if="mstats.stats.count"
                            py:with="stats = mstats.stats; interval_hrefs = mstats.interval_hrefs;
                                     stats_href = mstats.stats_href;"/>
              </div>
              <div class="description" xml:space="preserve">
                ${wiki_to_html(context(milestone.resource), milestone.description)}
              </div>
            </div>
          </py:for>
      </div>
    </div>
  </div>

    <div py:if="version_without_prj" class="milestone">
    <div class="smp-project-group">
      <div class="info">
          <h2>Versions without a Project</h2>
      </div>
      <div class="smp-grouped-ms">
        <py:for each="idx, version in enumerate(versions)">
            <div py:if="not version.id_project" class="milestone">
              <div class="info trac-progress" py:with="vstats = version_stats[idx]">
                <h3><a href="${href.version(version.name)}">
                  Version: <em>${version.name}</em>
                </a></h3>
                <py:choose>
                  <p py:when="version.time" class="date">
                    <i18n:msg params="duration, date">
                      Released ${dateinfo(version.time)} ago (${format_datetime(version.time)})
                    </i18n:msg>
                  </p>
                  <p py:otherwise="" class="date">
                    No date set
                  </p>
                </py:choose>
                <xi:include href="progress_bar.html" py:if="vstats.stats.count"
                            py:with="stats = vstats.stats; interval_hrefs = vstats.interval_hrefs;
                                     stats_href = vstats.stats_href;"/>
              </div>
              <div class="description" xml:space="preserve">
                ${wiki_to_html(context(version.resource), version.description)}
              </div>
            </div>
          </py:for>
      </div>
    </div>
  </div>


    <div py:for="proj in projects" class="milestone">
      <div class="smp-project-group">
        <div class="info">
          <h2>Project: <em>${proj.name}</em><span py:if="proj.summary"> - ${proj.summary}</span></h2>
        </div>
        <div class="smp-grouped-ms">
          ${wiki_to_html(context, proj.description)}

          <hr py:if="milestones" />
          <py:for each="idx, milestone in enumerate(milestones)">
            <div py:if="proj.id in milestone.id_project" class="milestone">
              <div class="info trac-progress" py:with="mstats = milestone_stats[idx]">
                <h3><a href="${href.milestone(milestone.name)}">
                  Milestone: <em>${milestone.name}</em>
                </a></h3>
                <py:choose>
                  <p py:when="milestone.completed" class="date">
                    <i18n:msg params="duration, date">
                      Completed ${dateinfo(milestone.completed)} ago (${format_datetime(milestone.completed)})
                    </i18n:msg>
                  </p>
                  <p py:when="milestone.is_late" class="date">
                    <i18n:msg params="duration, date">
                      <strong>${dateinfo(milestone.due)} late</strong> (${format_datetime(milestone.due)})
                    </i18n:msg>
                  </p>
                  <p py:when="milestone.due" class="date">
                    <i18n:msg params="duration, date">
                      Due in ${dateinfo(milestone.due)} (${format_datetime(milestone.due)})
                    </i18n:msg>
                  </p>
                  <p py:otherwise="" class="date">
                    No date set
                  </p>
                </py:choose>
                <xi:include href="progress_bar.html" py:if="mstats.stats.count"
                            py:with="stats = mstats.stats; interval_hrefs = mstats.interval_hrefs;
                                     stats_href = mstats.stats_href;"/>
              </div>
              <div class="description" xml:space="preserve">
                ${wiki_to_html(context(milestone.resource), milestone.description)}
              </div>
            </div>
          </py:for>

          <py:for each="idx, item in enumerate(versions)">
            <div py:if="proj.id in item.id_project" class="milestone">
              <div class="info trac-progress" py:with="mstats = version_stats[idx]">
                <h3><a href="${href.version(item.name)}">
                  Version: <em>${item.name}</em>
                </a></h3>
                <py:choose>
                  <p py:when="item.time" class="date">
                    <i18n:msg params="duration, date">
                      Released ${dateinfo(item.time)} ago (${format_datetime(item.time)})
                    </i18n:msg>
                  </p>
                  <p py:otherwise="" class="date">
                    No date set
                  </p>
                </py:choose>
                <xi:include href="progress_bar.html" py:if="mstats.stats.count"
                            py:with="stats = mstats.stats; interval_hrefs = mstats.interval_hrefs;
                                     stats_href = mstats.stats_href"/>
              </div>
              <div class="description" xml:space="preserve">
                ${wiki_to_html(context(item.resource), item.description)}
              </div>
            </div>
          </py:for>

        </div>
      </div> <!--! Grouped project -->
    </div>

</div>
