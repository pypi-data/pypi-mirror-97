!function(e){"use strict";function t(e){return e.nodeType===Node.ELEMENT_NODE}const n=["A","ABBR","ACRONYM","AUDIO","B","BDI","BDO","BIG","BR","BUTTON","CANVAS","CITE","CODE","DATA","DATALIST","DEL","DFN","EM","EMBED","I","IFRAME","IMG","INPUT","INS","KBD","LABEL","MAP","MARK","METER","NOSCRIPT","OBJECT","OUTPUT","PICTURE","PROGRESS","Q","RUBY","S","SAMP","SCRIPT","SELECT","SLOT","SMALL","SPAN","STRONG","SUB","SUP","SVG","TEMPLATE","TEXTAREA","TIME","U","TT","VAR","VIDEO","WBR"];function i(e,t){window.bridgeCommand(e,t)}let o=null;function s(){return o}function r(){const e=["bold","italic","underline","superscript","subscript"];for(const t of e){document.querySelector(`#${t}`).classList.toggle("highlighted",document.queryCommandState(t))}}let l=null;function c(e){a(),l=setTimeout((function(){r(),d(e,"key")}),600)}function a(){l&&(clearTimeout(l),l=null)}function d(e,t){a(),i(`${t}:${e.ord}:${s()}:${e.fieldHTML}`)}let u={},f={},h=["P","DIV","BR","SUB","SUP"];for(const e of h)u[e]={attrs:[]};h=["B","BLOCKQUOTE","CODE","DD","DL","DT","EM","H1","H2","H3","I","LI","OL","PRE","RP","RT","RUBY","STRONG","TABLE","U","UL"];for(const e of h)f[e]={attrs:[]};u.IMG={attrs:["SRC"]},f.A={attrs:["HREF"]},f.TR={attrs:["ROWSPAN"]},f.TD={attrs:["COLSPAN","ROWSPAN"]},f.TH={attrs:["COLSPAN","ROWSPAN"]},f.FONT={attrs:["COLOR"]};const m={color:!0,"background-color":!0,"font-weight":!0,"font-style":!0,"text-decoration-line":!0};f.SPAN=function(e){for(const t of[...e.attributes]){"STYLE"!==t.name.toUpperCase()&&e.removeAttributeNode(t)}for(const t of[...e.style]){const n=e.style.getPropertyValue(t);(!m.hasOwnProperty(t)||"background-color"===t&&"transparent"===n||document.body.classList.contains("nightMode")&&("background-color"===t||"color"===t))&&e.style.removeProperty(t)}},Object.assign(f,u);let g=function(e){(function(e){return e instanceof HTMLElement})(e)&&(e.style.removeProperty("background-color"),e.style.removeProperty("font-size"),e.style.removeProperty("font-family"));for(let t=0;t<e.children.length;t++){const n=e.children[t];g(n)}},E=function(e,n){if(!t(e))return;for(const t of[...e.children])E(t,n);if("ANKITOP"===e.tagName)return;const i=n?f[e.tagName]:u[e.tagName];if(i)if("function"==typeof i)i(e);else for(const t of[...e.attributes]){const n=t.name.toUpperCase();-1===i.attrs.indexOf(n)&&e.removeAttributeNode(t)}else e.innerHTML&&"TITLE"!==e.tagName?e.outerHTML=e.innerHTML:e.parentNode.removeChild(e)};function p(e){c(e.currentTarget)}function b(e){const n=e.currentTarget;if("Escape"!==e.code){if("Enter"!==e.code||function(e){const n=e.getSelection().anchorNode;let i=!1,o=t(n)?n:n.parentElement;for(;o;)i=i||"list-item"==window.getComputedStyle(o).display,o=o.parentElement;return i}(n)||(e.preventDefault(),document.execCommand("insertLineBreak")),n.isRightToLeft()){const t=n.getSelection(),i=e.ctrlKey?"word":"character",o=e.shiftKey?"extend":"move";switch(e.code){case"ArrowRight":return t.modify(o,"right",i),void e.preventDefault();case"ArrowLeft":return t.modify(o,"left",i),void e.preventDefault()}}c(n)}else n.blurEditable()}function T(e){const n=e.currentTarget;if("Enter"===e.code||"Backspace"===e.code){const e=n.getSelection().anchorNode;!t(e)||"DIV"!==e.tagName||e instanceof O||1!==e.childElementCount||"BR"!==e.children[0].tagName||e.replaceWith(e.children[0])}}function L(e){e.focusEditable(),i(`focus:${e.ord}`),$("button.linkb").prop("disabled",!1),function(e){const t=document.createRange();t.selectNodeContents(e.editable),t.collapse(!1);const n=e.getSelection();n.removeAllRanges(),n.addRange(t)}(e)}let y=null;function v(e){const t=e.currentTarget,n=e.relatedTarget;n!==y&&n instanceof O||L(t)}function C(e){const t=e.currentTarget;d(t,t===document.activeElement?"key":"blur"),y=t,$("button.linkb:not(.perm)").prop("disabled",!0)}function A(e,t,n){const i=e.match(/^(\s*)([^]*?)(\s*)$/);return i[1]+t+i[2]+n+i[3]}function S(e,t,n){const i=R().getSelection(),o=i.getRangeAt(0).cloneContents(),s=document.createElement("span");if(s.appendChild(o),n){D("inserttext",A(s.innerText,e,t))}else{D("inserthtml",A(s.innerHTML,e,t))}s.innerHTML||function(e,t){const n=e.getRangeAt(0);n.setStart(n.startContainer,n.startOffset-t.length),n.collapse(!0),e.removeAllRanges(),e.addRange(n)}(i,t)}function R(){return document.activeElement instanceof O?document.activeElement:null}function N(e){i("paste"),e.preventDefault()}function M(){return i("cutOrCopy"),!0}function B(e){if(0===e.childNodes.length)return!1;for(const o of e.children)if(t(i=o)&&!n.includes(i.tagName))return!1;var i;return!0}class k extends HTMLElement{set fieldHTML(e){this.innerHTML=e,B(this)&&this.appendChild(document.createElement("br"))}get fieldHTML(){return B(this)&&this.innerHTML.endsWith("<br>")?this.innerHTML.slice(0,-4):this.innerHTML}connectedCallback(){this.setAttribute("contenteditable","")}}customElements.define("anki-editable",k);class O extends HTMLDivElement{constructor(){super(),this.attachShadow({mode:"open"}),this.className="field";const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","./_anki/css/editable.css"),this.shadowRoot.appendChild(e),this.baseStyle=document.createElement("style"),this.baseStyle.setAttribute("rel","stylesheet"),this.shadowRoot.appendChild(this.baseStyle),this.editable=document.createElement("anki-editable"),this.shadowRoot.appendChild(this.editable)}get ord(){return Number(this.getAttribute("ord"))}set fieldHTML(e){this.editable.fieldHTML=e}get fieldHTML(){return this.editable.fieldHTML}connectedCallback(){this.addEventListener("keydown",b),this.addEventListener("keyup",T),this.addEventListener("input",p),this.addEventListener("focus",v),this.addEventListener("blur",C),this.addEventListener("paste",N),this.addEventListener("copy",M),this.addEventListener("oncut",M),this.addEventListener("mouseup",r);this.baseStyle.sheet.insertRule("anki-editable {}",0)}disconnectedCallback(){this.removeEventListener("keydown",b),this.removeEventListener("keyup",T),this.removeEventListener("input",p),this.removeEventListener("focus",v),this.removeEventListener("blur",C),this.removeEventListener("paste",N),this.removeEventListener("copy",M),this.removeEventListener("oncut",M),this.removeEventListener("mouseup",r)}initialize(e,t){this.setBaseColor(e),this.editable.fieldHTML=t}setBaseColor(e){this.baseStyle.sheet.cssRules[0].style.color=e}setBaseStyling(e,t,n){const i=this.baseStyle.sheet.cssRules[0];i.style.fontFamily=e,i.style.fontSize=t,i.style.direction=n}isRightToLeft(){return"rtl"===this.editable.style.direction}getSelection(){return this.shadowRoot.getSelection()}focusEditable(){this.editable.focus()}blurEditable(){this.editable.blur()}}customElements.define("anki-editing-area",O,{extends:"div"});class I extends HTMLDivElement{constructor(){super(),this.labelContainer=document.createElement("div"),this.labelContainer.className="fname",this.appendChild(this.labelContainer),this.label=document.createElement("span"),this.label.className="fieldname",this.labelContainer.appendChild(this.label),this.editingArea=document.createElement("div",{is:"anki-editing-area"}),this.appendChild(this.editingArea)}static get observedAttributes(){return["ord"]}set ord(e){this.setAttribute("ord",String(e))}attributeChangedCallback(e,t,n){switch(e){case"ord":this.editingArea.setAttribute("ord",n)}}initialize(e,t,n){this.label.innerText=e,this.editingArea.initialize(t,n)}setBaseStyling(e,t,n){this.editingArea.setBaseStyling(e,t,n)}}function P(e){var t;return null!==(t=document.getElementById("fields").children[e])&&void 0!==t?t:null}function H(e,t){const n=document.getElementById("fields").children;for(let i=0;i<n.length;i++){t(n[i],e[i])}}function D(e,t,n=!1){document.execCommand(e,!1,t),n||(d(R(),"key"),r())}customElements.define("anki-editor-field",I,{extends:"div"}),e.EditingArea=O,e.EditorField=I,e.focusField=function(e){const t=P(e);t&&t.editingArea.focusEditable()},e.focusIfField=function(e,t){const n=document.elementsFromPoint(e,t);for(let e=0;e<n.length;e++){let t=n[e];if(t instanceof O)return t.focusEditable(),!0}return!1},e.forEditorField=H,e.getCurrentField=R,e.getEditorField=P,e.getNoteId=s,e.pasteHTML=function(e,t,n){""!==(e=function(e,t,n){const i=document.createElement("ankitop");i.innerHTML=e,t?g(i):E(i,n);let o=i.innerHTML;return n||t||(o=o.replace(/[\n\t ]+/g," ")),o=o.trim(),o}(e,t,n))&&D("inserthtml",e)},e.preventButtonFocus=function(){for(const e of document.querySelectorAll("button.linkb"))e.addEventListener("mousedown",(e=>{e.preventDefault()}))},e.saveNow=function(e){const t=R();t&&(a(),e?d(t,"key"):t.blurEditable())},e.setBackgrounds=function(e){H(e,((e,t)=>e.editingArea.classList.toggle("dupe","dupe"===t))),document.getElementById("dupes").classList.toggle("is-inactive",!e.includes("dupe"))},e.setFGButton=function(e){document.getElementById("forecolor").style.backgroundColor=e},e.setFields=function(e){const t=window.getComputedStyle(document.documentElement).getPropertyValue("--text-fg");!function(e){const t=document.getElementById("fields");for(;t.childElementCount<e;){const e=document.createElement("div",{is:"anki-editor-field"});e.ord=t.childElementCount,t.appendChild(e)}for(;t.childElementCount>e;)t.removeChild(t.lastElementChild)}(e.length),H(e,((e,[n,i])=>e.initialize(n,t,i)))},e.setFonts=function(e){H(e,((e,[t,n,i])=>{e.setBaseStyling(t,`${n}px`,i?"rtl":"ltr")}))},e.setFormat=D,e.setNoteId=function(e){o=e},e.toggleEditorButton=function(e){$(e)[0].classList.toggle("highlighted")},e.wrap=function(e,t){S(e,t,!1)},e.wrapIntoText=function(e,t){S(e,t,!0)},Object.defineProperty(e,"__esModule",{value:!0})}(this.globalThis=this.globalThis||{});
