.\" Man page generated from reStructuredText.
.
.TH "DEBOPS.PROSODY" "5" "Mar 03, 2021" "v2.0.8" "DebOps"
.SH NAME
debops.prosody \- Manage Prosody XMPP server with Ansible
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.sp
\fBdebops.prosody\fP configures and manages the XMPP server prosody.
.SH GETTING STARTED
.SS Default configuration
.sp
The configuration is split into 3 basic parameters,
this is because of limitation of YAML and easier representation.
.INDENT 0.0
.IP \(bu 2
prosody__*_config_global
.IP \(bu 2
prosody__*_config_components
.IP \(bu 2
prosody__*_config_virtual_hosts
.UNINDENT
.sp
By default there are two components active \fBprosody__http_upload\fP \fBprosody__muc\fP
Set this varables to false to disable the specific component.
.SS Domains
.sp
The default virtual host uses \fBprosody__domain\fP as domain.
.sp
The components uses two subdomains: conference.\(gaprosody__domain and upload.\(gaprosody__domain\(ga
.SS Ports
.sp
By default the ports are:
\- \fI5222\fP (c2s)
\- \fI5269\fP (s2s)
\- \fI5280\fP http
\- \fI5281\fP https
.SS Example inventory
.sp
To enable Prosody server support on a host, it needs to be included in the Ansible inventory in a specific group:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
[debops_service_prosody]
hostname
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Example playbook
.sp
If you are using this role without DebOps, here\(aqs an example Ansible playbook
that uses the \fBdebops.prosody\fP role:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
\-\-\-

\- name: Manage Prosody
  collections: [ \(aqdebops.debops\(aq, \(aqdebops.roles01\(aq,
                 \(aqdebops.roles02\(aq, \(aqdebops.roles03\(aq ]
  hosts: [ \(aqdebops_service_prosody\(aq ]
  become: True

  environment: \(aq{{ inventory__environment | d({})
                   | combine(inventory__group_environment | d({}))
                   | combine(inventory__host_environment  | d({})) }}\(aq

  roles:

    \- role: ferm
      tags: [ \(aqrole::ferm\(aq, \(aqskip::ferm\(aq ]
      ferm__dependent_rules:
        \- \(aq{{ prosody__ferm__dependent_rules }}\(aq

    \- role: prosody
      tags: [ \(aqrole::prosody\(aq, \(aqskip::prosody\(aq ]

.ft P
.fi
.UNINDENT
.UNINDENT
.SS Ansible tags
.sp
You can use Ansible \fB\-\-tags\fP or \fB\-\-skip\-tags\fP parameters to limit what
tasks are performed during Ansible run. This can be used after a host was first
configured to speed up playbook execution, when you are sure that most of the
configuration is already in the desired state.
.sp
Available role tags:
.INDENT 0.0
.TP
.B \fBrole::prosody\fP
Main role tag, should be used in the playbook to execute all of the role
tasks as well as role dependencies.
.TP
.B \fBrole::ferm\fP
Role tag for configure the firewall ferm.
.UNINDENT
.SH AUTHOR
Norbert Summer
.SH COPYRIGHT
2014-2021, Maciej Delmanowski, Nick Janetakis, Robin Schneider and others
.\" Generated by docutils manpage writer.
.
