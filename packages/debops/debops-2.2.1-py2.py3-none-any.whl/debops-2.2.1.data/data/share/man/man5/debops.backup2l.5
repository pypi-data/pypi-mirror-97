.\" Man page generated from reStructuredText.
.
.TH "DEBOPS.BACKUP2L" "5" "Mar 04, 2021" "v2.2.1" "DebOps"
.SH NAME
debops.backup2l \- Manage backup2l script using Ansible
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.SH SYNOPSIS
.sp
\fBdebops service/backup2l\fP [\fB\-\-limit\fP \fIgroup,host,\fP\&...] [\fB\-\-diff\fP] [\fB\-\-check\fP] [\fB\-\-tags\fP \fItag1,tag2,\fP\&...] [\fB\-\-skip\-tags\fP \fItag1,tag2,\fP\&...] [<\fBansible\-playbook\fP options>] ...
.SH DESCRIPTION
.sp
The \fBdebops.backup2l\fP role manages the \fI\%backup2l\fP <\fBhttps://github.com/gkiefer/backup2l\fP> (backup tool) script.
This script can be used to make automated, incremental archives of a given host
which can be copied to another system as a backup.
.SH GETTING STARTED
.SS Default configuration
.sp
By default the backups are maintained in the \fB/var/backups/backup2l/\fP
subdirectory, which will be automatically excluded from the archive.
.sp
The role configures the \fBbackup2l\fP script to read the list of paths to
backup from an external file, by default stored in
\fB/usr/local/etc/backup/include\fP\&. This file is maintained using the
\fBlineinfile\fP Ansible module, therefore other Ansible roles or the system
administrators can add their own paths to it without breaking idempotency. This
functionality can be disabled using the \fBbackup2l__srclist_from_file\fP
variable.
.sp
The \fBbackup2l\fP script will execute pre\-hooks and post\-hooks from
specific directories, by default:
.INDENT 0.0
.IP \(bu 2
pre\-hooks: \fB/usr/local/etc/backup/pre\-hook.d/\fP
.IP \(bu 2
post\-hooks: \fB/usr/local/etc/backup/post\-hook.d/\fP
.UNINDENT
.sp
These directories can contain scripts which execute certain actions before or
after a backup is performed. This can be used to for example, send new archives
to a remote file using the \fBrsync\fP command. You can use the
debops.resources Ansible role to provide custom pre/post hooks.
.sp
The pre/post hook integration is designed to be "agnostic", and it\(aqs best not
to rely on a specific backup solution, ie. \fBbackup2l\fP in this case, to
execute actions. You can maintain your own directories and files in the
\fB/var/backups/\fP directory, which will be subsequently included in the
\fBbackup2l\fP archive.
.SS Ansible local facts
.sp
The \fBdebops.backup2l\fP role provides a set of Ansible local facts available in
the \fBansible_local.backup2l.*\fP hierarchy. Other Ansible roles can use these
facts to include additional configuration using pre/post hook scripts, or add
their own paths to the list of paths archived by the script.
.SS Example inventory
.sp
To enable \fBbackup2l\fP script on a given host, it needs to be included
in the \fB[debops_service_backup2l]\fP Ansible inventory group:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
[debops_service_backup2l]
hostname
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Example playbook
.sp
If you are using this role without DebOps, here\(aqs an example Ansible playbook
that uses the \fBdebops.backup2l\fP role:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
\-\-\-

\- name: Configure backup2l service
  collections: [ \(aqdebops.debops\(aq, \(aqdebops.roles01\(aq,
                 \(aqdebops.roles02\(aq, \(aqdebops.roles03\(aq ]
  hosts: [ \(aqdebops_service_backup2l\(aq ]
  become: True

  environment: \(aq{{ inventory__environment | d({})
                   | combine(inventory__group_environment | d({}))
                   | combine(inventory__host_environment  | d({})) }}\(aq

  roles:

    \- role: backup2l
      tags: [ \(aqrole::backup2l\(aq, \(aqskip::backup2l\(aq ]

.ft P
.fi
.UNINDENT
.UNINDENT
.SS Ansible tags
.sp
You can use Ansible \fB\-\-tags\fP or \fB\-\-skip\-tags\fP parameters to limit what
tasks are performed during Ansible run. This can be used after a host was first
configured to speed up playbook execution, when you are sure that most of the
configuration is already in the desired state.
.sp
Available role tags:
.INDENT 0.0
.TP
.B \fBrole::backup2l\fP
Main role tag, should be used in the playbook to execute all of the role
tasks as well as role dependencies.
.UNINDENT
.SH AUTHOR
Maciej Delmanowski
.SH COPYRIGHT
2014-2021, Maciej Delmanowski, Nick Janetakis, Robin Schneider and others
.\" Generated by docutils manpage writer.
.
