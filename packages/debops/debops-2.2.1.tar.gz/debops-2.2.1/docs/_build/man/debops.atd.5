.\" Man page generated from reStructuredText.
.
.TH "DEBOPS.ATD" "5" "Mar 04, 2021" "v2.2.1" "DebOps"
.SH NAME
debops.atd \- Manage at and batch commands using Ansible
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.SH SYNOPSIS
.sp
\fBdebops service/atd\fP [\fB\-\-limit\fP \fIgroup,host,\fP\&...] [\fB\-\-diff\fP] [\fB\-\-check\fP] [\fB\-\-tags\fP \fItag1,tag2,\fP\&...] [\fB\-\-skip\-tags\fP \fItag1,tag2,\fP\&...] [<\fBansible\-playbook\fP options>] ...
.SH DESCRIPTION
.sp
The \fBat\fP and \fBbatch\fP commands can be used to compliment \fBcron\fP and run
one\-off tasks either at a specified time, or when the host CPU utilization is on
a low enough level.
.sp
The \fBdebops.atd\fP role can be used to configure the \fBatd\fP service, including
randomized load average threshold and randomized time between batch job
execution, as well as access control to the \fBat\fP and \fBbatch\fP commands by
the users.
.SH GETTING STARTED
.SS Initial configuration
.sp
\fBdebops.atd\fP will install the \fBat\fP Debian package which provides the
\fBatd\fP service as well as commands that allow you to schedule jobs at a
specific time or when the host CPU load average is below a specific threshold.
.sp
By default the interval of the \fBbatch\fP command checking if jobs can be run, as
well as the level of CPU utilization which halts job scheduling are somewhat
randomized to "smooth out" CPU utilization on hosts with multiple virtual
machines and/or containers. See the default variables for the minimum and
maximum values for each.
.sp
After installation, the role creates a \fB/etc/at.allow\fP file which only enables the use
of the \fBat\fP and \fBbatch\fP commands by the Ansible admin account (superuser
has implicit access). You can either add specific users to this list by using
\fBatd_*_allow\fP list variables, or enable access by all users not listed in
\fB/etc/at.deny\fP by defining \fBatd_default_allow\fP as empty list (\fB[]\fP).
.SS Example inventory
.sp
\fBdebops.atd\fP is included by default in the \fBcommon.yml\fP DebOps playbook;
you don\(aqt need to do anything to have it installed.
.sp
If you want to disable the \fBatd\fP service on a host or set of hosts, you can do
this by the setting variable:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
atd_enabled: False
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
in Ansible\(aqs inventory.
.SS Example playbook
.sp
Here\(aqs an example playbook that can be used to enable and manage the \fBatd\fP
service on a set of hosts:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
\-\-\-
\- name: Configure atd service
  hosts: debops_atd
  become: True

  roles:

    \- role: debops.atd
      tags: [ \(aqrole::atd\(aq ]
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Ansible tags
.sp
You can use Ansible \-\-tags or \-\-skip\-tags parameters to limit what
tasks are performed during Ansible run. This can be used after the host is first
configured to speed up playbook execution, when you are sure that most of the
configuration has not been changed.
.sp
Available role tags:
.INDENT 0.0
.TP
.B \fBrole::atd\fP
Main role tag, should be used in the playbook to execute all of the role
tasks.
.TP
.B \fBrole::atd:users\fP
Configure contents of \fB/etc/at.allow\(ga\fP and \fB/etc/at.deny\fP configuration
files.
.UNINDENT
.SH AUTHOR
Maciej Delmanowski
.SH COPYRIGHT
2014-2021, Maciej Delmanowski, Nick Janetakis, Robin Schneider and others
.\" Generated by docutils manpage writer.
.
