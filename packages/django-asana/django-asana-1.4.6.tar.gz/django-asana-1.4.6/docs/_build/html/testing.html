

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Testing Your Code &mdash; django-asana 1.3.5 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sync from Asana" href="modules/sync_from_asana.html" />
    <link rel="prev" title="Creating Data in Asana" href="create_data.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> django-asana
          

          
          </a>

          
            
            
              <div class="version">
                1.3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme_include.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme_include.html#about">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme_include.html#requirements">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme_include.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme_include.html#quick-start">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme_include.html#command-line-options">Command line options</a></li>
<li class="toctree-l1"><a class="reference internal" href="readme_include.html#running-tests">Running tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_data.html">Creating Data in Asana</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing Your Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/sync_from_asana.html">Sync from Asana</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/connect.html">Connect</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/views.html">Views</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">django-asana</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Testing Your Code</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing-your-code">
<h1>Testing Your Code<a class="headerlink" href="#testing-your-code" title="Permalink to this headline">Â¶</a></h1>
<p>Asana does not provide a testing sandbox API. When testing the integration of your application with Asana, you will likely want to mock any connections to Asana that would write data to avoid creating a lot of junk data in Asana.</p>
<p>Some strategies for testing with django-asana are as follows:</p>
<blockquote>
<div><ul class="simple">
<li>Override the ASANA_ACCESS_TOKEN setting so that if your tests do reach out to Asana they will get an authentication error instead of writing bad data. This would be unnecessary if you follow the other steps, but by adding it to your TestCase, any new tests that do not mock your connections to Asana will fail loudly. If you want to test a read from Asana, you would not want to override your credentials.</li>
<li>Mock the connection itself. django-asana provides some mock responses you can test with.</li>
<li>When you need multiple mocks returned for database insertion, you will want them all to have unique ids to avoid integrity errors.</li>
</ul>
</div></blockquote>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="k">import</span> <span class="n">MagicMock</span><span class="p">,</span> <span class="n">patch</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="k">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">override_settings</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="k">import</span> <span class="n">patch</span>

<span class="k">def</span> <span class="nf">counter</span><span class="p">():</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">yield</span> <span class="n">count</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="n">COUNTER</span> <span class="o">=</span> <span class="n">counter</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;assignee&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;assignee&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;assignee&#39;</span><span class="p">]}</span>
    <span class="k">if</span> <span class="s1">&#39;parent&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]}</span>
    <span class="k">return</span> <span class="n">task</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">new_task</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a mock Asana response for a task create.&quot;&quot;&quot;</span>
    <span class="n">task_</span> <span class="o">=</span> <span class="n">get_task</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">task_</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">COUNTER</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_</span>


<span class="k">def</span> <span class="nf">update_task</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a mock Asana response for an update.</span>

<span class="sd">    update gets passed a tuple: (id, dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">task_</span> <span class="o">=</span> <span class="n">get_task</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">task_</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">task_</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">ASANA_ACCESS_TOKEN</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>  <span class="c1"># Assures your credentials are not real</span>
<span class="k">class</span> <span class="nc">TestTask</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;djasana.models.client_connect&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_update_date_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_connect</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Demonstrates how to mock for testing purposes.&quot;&quot;&quot;</span>
    <span class="n">mock_client</span> <span class="o">=</span> <span class="n">mock_connect</span><span class="o">.</span><span class="n">return_value</span>
    <span class="n">mock_client</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">find_all</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="p">()]</span>
    <span class="n">mock_client</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">new_task</span>
    <span class="n">mock_client</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">update</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">update_task</span>
    <span class="n">mock_client</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">set_parent</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">new_task</span>
    <span class="c1"># Do something with those mocks</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modules/sync_from_asana.html" class="btn btn-neutral float-right" title="Sync from Asana" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_data.html" class="btn btn-neutral" title="Creating Data in Asana" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Steve Bywater.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.3.5',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>