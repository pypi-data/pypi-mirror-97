!function(e){function t(t,i){if(i=e.extend({},e.fn.djangoInline.defaults,i),this.group=t,this.$group=e(t),this.options=i,i.prefix=i.prefix||this.$group.attr("id").replace(/-group$/,""),i.formTemplate)this.$form_template=e(i.formTemplate);else{this.$form_template=this.$group.children(".js-django-inlines-forms").children(this.options.emptyFormSelector);var r=e("input,textarea,select").filter("[required]:hidden");r.prop("required",!1),r.addClass("required")}!1!==i.showAddButton&&(this.$addButton=this.$group.find(".js-django-inlines-add-form-"+i.prefix),this.$addButton.length?(this.$addButton.filter("a, button").click(e.proxy(this._onAddButtonClick,this)),this.$addButton.find("a, button").click(e.proxy(this._onAddButtonClick,this))):this.$addButton=this.createAddButton(),this._toggleAddButtonDisplay());var o=this;this.$group.on("click",".js-django-inlines-remove-form",(function(e){e.preventDefault(),o.removeForm(this)}))}t.prototype={createAddButton:function(){var t;return this.options.childTypes?(t=e(this._renderPolymorphicAddButton()),this.$group.after(t),t.children("a").click(e.proxy(this._onMenuToggle,this)),t.find("li a").click(e.proxy(this._onAddButtonClick,this))):(t=e(this._renderAddButton()),this.$group.after(t),t.find("a").click(e.proxy(this._onAddButtonClick,this))),t},_renderAddButton:function(){return""},_renderPolymorphicAddButton:function(){for(var e='<div class="add-form-choice-menu" style="display: none;"><ul>',t=0;t<this.options.childTypes.length;t++){var i=this.options.childTypes[t];e+='<li><a href="#" data-type="'+i.type+'">'+i.name+"</a></li>"}return e+="</ul></div>",'<div class="'+this.options.addCssClass+' add-form-choice"><a href="#">'+this.options.addText+"</a>"+e+"</div>"},_onMenuToggle:function(t){t.preventDefault(),t.stopPropagation();var i=e(t.target).next(".add-form-choice-menu");if(!i.is(":visible")){e(document).click((function t(){i.slideUp(),e(document).unbind("click",t)}))}i.slideToggle()},_onAddButtonClick:function(t){t.preventDefault();var i=e(t.target).attr("data-type"),r=i?this.options.emptyFormSelector+"[data-inline-type="+i+"]":null;this.addForm(r)},_toggleAddButtonDisplay:function(){var e=this._getManagementForm(),t=e.max_forms&&e.max_forms.value&&parseInt(e.total_forms.value)>=parseInt(e.max_forms.value);this.$addButton.toggle(!t)},_setFieldOrder:function(e,t,i){t.find("[id^='"+e+"'][id$='"+this.options.orderFieldName+"']:not([id^='detail-items-'])").val(10*i)},setFieldOrder:function(e){var t=this.getFieldIdPrefix(e),i=this.getFormAt(e);this._setFieldOrder(t,i,i.index()+1)},setFormOrder:function(){for(var e=this._getManagementForm(),t=parseInt(e.total_forms.value),i=0;i<t;i++)this.setFieldOrder(i)},moveUp:function(e){var t=e.previousElementSibling;return t?(t.classList.contains(this.options.emptyFormSelector.substring(1))&&(t=t.previousElementSibling),t&&e.parentNode.insertBefore(e,t),t):t},moveDown:function(e){var t=e.nextElementSibling;return t?(t.classList.contains(this.options.emptyFormSelector.substring(1))&&(t=t.nextElementSibling),t&&e.parentNode.insertBefore(t,e),t):t},moveFieldUp:function(t){var i=this.getFormAt(t);if(0!==i.length){var r=e(this.moveUp(i[0]));if(0!==r.length){var o=this.getFormIndex(r);this.setFieldOrder(t),this.setFieldOrder(o),0===i.index()&&(i.find("div.row > div > label.sr-only").removeClass("sr-only").addClass("control-label"),r.find("div.row > div > label").addClass("sr-only").removeClass("control-label"))}}},moveFieldDown:function(t){var i=this.getFormAt(t);if(0!==i.length){var r=e(this.moveDown(i[0]));if(0!==r.length){var o=this.getFormIndex(r);this.setFieldOrder(t),this.setFieldOrder(o),0===r.index()&&(r.find("div.row > div > label.sr-only").removeClass("sr-only").addClass("control-label"),i.find("div.row > div > label").addClass("sr-only").removeClass("control-label"))}}},addForm:function(t){var i;if(t){if(0===(i=this.$form_template&&this.$form_template.length>0?this.$form_template.filter(t):this.$group.find(t)).length)throw new Error("Form template '"+t+"' not found")}else{if(!this.$form_template||0===this.$form_template.length)throw new Error("No empty form available. Define the 'form_template' setting or add an '.empty-form' element in the '"+this.options.prefix+"' formset group!");i=this.$form_template}i.find(".select2").remove();var r,o=this._getManagementForm();if(!o.total_forms)throw new Error("Missing '#"+this._getGroupFieldIdPrefix()+"-TOTAL_FORMS' field. Make sure the management form included!");if(null===(r=null==this.options.newFormTarget?i.parent():e.isFunction(this.options.newFormTarget)?this.options.newFormTarget.apply(this.group):this.$group.find(this.options.newFormTarget))||0===r.length)throw new Error("No container found via custom 'newFormTarget' function!");var n=parseInt(o.total_forms.value),s=this._getFormId(n),a=i.clone();a.find('[id*="__prefix__"],[name*="__prefix__"],[for*="__prefix__"],[class*="__prefix__"]').each((function(){function t(e,t){var i=e.attr(t);void 0!==i&&i.includes("__prefix__")&&(i=i.replace(/__prefix__/,n),e.attr(t,i))}var i=e(this);t(i,"id"),t(i,"name"),t(i,"for"),"DIV"===i[0].tagName&&this.classList.contains("js-django-inlines")&&t(i,"data-options"),"A"===i[0].tagName&&this.className.match(/__prefix__/)&&t(i,"class")})),(a=a.removeClass("empty-form").attr("id",s)).find('.empty-form:not([id*="__prefix__"])').removeClass("empty-form"),n>0&&e('div:not([id^="detail-items-"])',a).filter('div:not([id^="detail-template-"])').find(".ftl-inlines-first-only").each((function(t,i){e(i).removeClass("ftl-inlines-first-only").addClass("sr-only")})),n>0&&a.find("div.row > div > label").addClass("sr-only").removeClass("control-label");var l=null;e('.ftl-seq:not([id*="__prefix__"])').each((function(){console.log(e(this));var t=parseInt(this.value);l=t>l?t:l})),a.find('.ftl-seq:not([id*="__prefix__"])').each((function(e,t){t.value=++l})),r.append(a);var d=e("#"+s);if(0===d.length)throw new Error("New FormSet item not found: #"+s);return d.data("djangoInlineIndex",n),a.find(".required").prop("required",!0).removeClass("required"),this.options.onAdd&&this.options.onAdd.call(this.group,d,n,this.options),this.setFieldOrder(n),o.total_forms.value=n+1,d},getFormAt:function(t){return e("#"+this._getFormId(t))},_getFormId:function(e){return this.options.itemIdTemplate.replace("{prefix}",this.options.prefix).replace("{index}",e)},_getGroupFieldIdPrefix:function(){return this.options.autoId.replace("{prefix}",this.options.prefix)},_getManagementForm:function(){var t=this._getGroupFieldIdPrefix();return{total_forms:e("#"+t+"-TOTAL_FORMS")[0],initial_forms:e("#"+t+"-INITIAL_NUM_FORMS")[0],min_forms:e("#"+t+"-MIN_NUM_FORMS")[0],max_forms:e("#"+t+"-MAX_NUM_FORMS")[0],group_id_prefix:t}},_getItemData:function(t){var i=e(t).closest(this.options.itemsSelector);if(0===i.length)return null;var r=i.attr("id"),o=new RegExp("^"+this.options.itemIdTemplate.replace("{prefix}","(.+?)").replace("{index}","(\\d+)")+"$").exec(r);return{formset_item:i,prefix:o[1],index:parseInt(o[2],0)}},_getItemForm:function(t){var i=this._getItemData(t);if(null===i)return null;var r=this._getGroupFieldIdPrefix()+"-"+i.index;return e.extend({},i,{field_id_prefix:r,field_name_prefix:i.prefix+"-"+i.index,pk_field:e("#"+r+"-"+this.options.pkFieldName),delete_checkbox:e("#"+r+"-DELETE")})},removeForm:function(t){var i=this._getManagementForm(),r=this._getItemForm(t);if(null===r)throw new Error("No form found for the selector '"+t.selector+"'!");var o=parseInt(i.total_forms.value),n=0!==r.pk_field.length;if(this.options.onBeforeRemove&&this.options.onBeforeRemove.call(this.group,r.formset_item,this.options),n&&r.pk_field[0].value){if(r.delete_checkbox.length)r.delete_checkbox.attr("checked",!0);else{var s='<label class="" for="\' + itemform.field_id_prefix + \'-DELETE"><input type="checkbox" id="'+r.field_id_prefix+'-DELETE" name="'+r.field_name_prefix+'-DELETE" value="on" class="checkboxinput">Apagar</label>';e(s).appendTo(r.formset_item)}r.formset_item.hide()}else{for(var a=r.index+1;a<o;a++)this._renumberItem(this.getFormAt(a),a-1);i.total_forms.value--,r.formset_item.remove()}return this.options.onRemove&&this.options.onRemove.call(this.group,r.formset_item,this.options),r.formset_item},_renumberItem:function(t,i){var r=new RegExp("("+this._getFormId("([-]?\\d+|__prefix__)")+")"),o=(new RegExp("^("+this.options.autoId.replace("{prefix}",this._getFormId("([-]?\\d+|__prefix__)-order"))+")"),this._getFormId(i));t.data("djangoInlineIndex",i);for(var n=t.add(t.find("*")),s=0;s<n.length;s++){var a=n[s],l=e(a),d=l.attr("for");d&&d.match(r)&&l.attr("for",d.replace(r,o)),a.id&&a.id.match(r)&&(a.id=a.id.replace(r,o)),a.name&&a.name.match(r)&&(a.name=a.name.replace(r,o))}},getFormIndex:function(e){var t=this._getItemData(e);return t?t.index:null},getForms:function(){return this.$group.children(".js-django-inlines-forms").children(this.options.itemsSelector+":not("+this.options.emptyFormSelector+")")},getEmptyForm:function(){return this.$form_template},getFieldIdPrefix:function(t){if(!e.isNumeric(t)){var i=this._getItemData(t);if(null===i)throw new Error("Unexpected element in getFieldIdPrefix, needs to be item_index, or DOM child node.");t=i.index}return this._getGroupFieldIdPrefix()+"-"+t},getFieldsAt:function(e){var t=this.getFormAt(e);return this.getFields(t)},getFields:function(e){var t=this._getItemData(e);if(null===t)return null;for(var i={},r=t.formset_item.find(":input"),o=this.options.prefix+"-"+t.index,n=0;n<r.length;n++){var s=r[n].name;if(s.substring(0,o.length)===o)i[s.substring(o.length+1)]=r[n]}return i},removeFormAt:function(e){return this.removeForm(this.getFormAt(e))}},e.fn.djangoInline=function(i){var r=Array.prototype.splice.call(arguments,1),o="string"==typeof i,n=o?void 0:this;return this.filter(".inline-group").each((function(){var o=e(this),s=o.data("djangoInline");if(!s){var a="object"==typeof i?i:{};o.data("djangoInline",s=new t(this,a))}"string"==typeof i&&(n=s[i].apply(s,r))})),n},e.fn.djangoInline.defaults={pkFieldName:"id",autoId:"id_{prefix}",prefix:null,newFormTarget:null,itemIdTemplate:"{prefix}-{index}",itemsSelector:".inline-related",emptyFormSelector:".empty-form",formTemplate:null,childTypes:null,showAddButton:!0,addText:"add another",addCssClass:"add-row",orderFieldName:"order"},e.fn.djangoInline.Constructor=t,e.fn.ready((function(){e(".js-django-inlines").each((function(){var t=e(this),i=t.data();t.djangoInline(i.options||i)}))}))}(window.django?window.django.jQuery:jQuery);