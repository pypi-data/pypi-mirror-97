riot.tag2("ftl-include",'<div> {responseText} <div ref="dados"></div> <div ref="prog"></div> </div>',"","",(function(opts){var self=this;function scriptExecute(extrajavascript){void 0!==extrajavascript&&eval(extrajavascript)}self.debug=!1,self.loading_timeout=null;const fetch=()=>{$.ajax({url:opts.include.url,xhrFields:{withCredentials:!0},beforeSend:function(e,t){e.setRequestHeader("X-CSRFToken",getCookie("csrftoken")),e.setRequestHeader("HTTP_X_CSRFTOKEN",getCookie("csrftoken")),self.trigger("loading")},success:function(e){return self.trigger("updateContent",e),self.trigger("loaded",e),!1},error:function(e,t,o){return self.debug&&console.log("Something went wrong: >"+e+"< >"+t+"< >"+o+"<"),403===e.status?(alert("Desculpe, mas você não tem permissão!"),window.history.back()):(alert("Request failed.  Returned status of "+e.status),document.open(),document.write(e.responseText),document.close()),!1}})};self.on("mount",()=>{self.debug&&console.log("ftl-include: mount:",opts.include.url),fetch()}),self.on("loading",()=>{self.debug&&console.log("ftl-include: loading"),document.getElementById("ftl-page-load").value="loading",self.loading_timeout=setTimeout((function(){document.getElementById("ftl-loading").style.display="grid"}),500)}),self.on("loaded",e=>{self.debug&&console.log("ftl-include: loaded"),document.getElementById("ftl-page-load").value="loaded",document.getElementById("ftl-loading").style.display="none",clearTimeout(self.loading_timeout)}),self.on("updateContent",e=>{if(void 0!==e.msg&&null!==e.msg&&(self.debug&&console.log(e.msg),riot.mount("ftl-error-message",{messages:e.msg})),void 0!==e.alert&&null!==e.alert&&(self.debug&&console.log(e.alert),alert(e.alert)),void 0!==e.redirect&&null!==e.redirect)return scriptExecute(e.extrajavascript),void(window.location.href=e.redirect);opts.include.safe?self.refs.dados.innerHTML=e.html:self.responseText=e.html,void 0===e.form_errors&&void 0===e.formset_errors||$('input[name="save"]').show(),self.debug&&console.log("OK: ---\x3e"+e+"<---"),scriptExecute(e.extrajavascript),$(self.refs.dados).find('form:not([ref="modalForm"])').each((function(){$(this).attr("action",opts.include.url+(opts.include.url.endsWith("/")?"":"/")),$("<input>").attr({type:"hidden",name:"csrfmiddlewaretoken",value:getCookie("csrftoken")}).appendTo(this),$(this).submit((function(e){riot.store.trigger("ftl-include.pre-submit",this,e),$(":disabled").removeProp("disabled");var t=$(document.activeElement)[0].name,o=$(document.activeElement)[0].value;"checkbox"===$(document.activeElement)[0].type&&(o=$(document.activeElement)[0].checked),document.activeElement.disabled=!0,$f=$(this);var r=$f.attr("method"),n=($f.serialize(),new FormData($f[0]));n.append(t,o);var s=$f.attr("action");return $.ajax({type:r,url:s,data:n,processData:!1,contentType:!1,dataType:"json",cache:!1,xhrFields:{withCredentials:!0},beforeSend:function(e,t){e.setRequestHeader("X-CSRFToken",getCookie("csrftoken")),e.setRequestHeader("HTTP_X_CSRFTOKEN",getCookie("csrftoken")),self.trigger("loading")},success:function(e){return self.trigger("loaded",e),void 0!==e.form_errors&&null!==e.form_errors||void 0!==e.formset_errors&&null!==e.formset_errors?self.trigger("updateContent",e):void 0!==e.goto&&(scriptExecute(e.extrajavascript),route("/"+e.goto)),self.debug&&console.log("OK: ---\x3e"+e+"<---"),self.trigger("updateContent",e),!1},error:function(e,t,o){return self.debug&&console.log("Something went wrong: >"+e+"< >"+t+"< >"+o+"<"),document.open(),document.write(e.responseText),document.close(),!1}}),!1}))})),self.update()})}));