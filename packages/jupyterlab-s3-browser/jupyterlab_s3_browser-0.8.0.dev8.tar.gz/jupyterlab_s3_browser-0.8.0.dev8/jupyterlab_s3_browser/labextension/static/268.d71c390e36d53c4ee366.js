(self.webpackChunkjupyterlab_s3_browser=self.webpackChunkjupyterlab_s3_browser||[]).push([[268],{268:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var o,s=r(408),n=r(389),i=r(728),a=r(962),c=r(168),l=r(275),d=r(290),u=r(22);class h{constructor(e){this._isDisposed=!1,this._fileChanged=new c.Signal(this),this._registry=e}get name(){return"S3"}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,c.Signal.clearData(this))}get(e,t){return this.pathToJupyterContents(e)}getDownloadUrl(e){return console.log("not yet implemented"),Promise.reject("Not yet implemented")}newUntitled(e={}){return Promise.reject("Not yet implemented")}delete(e){return Promise.reject("Not yet implemented")}rename(e,t){return Promise.reject("Not yet implemented")}save(e,t){return Promise.reject("Not yet implemented")}copy(e,t){return Promise.reject("Not yet implemented")}createCheckpoint(e){return Promise.reject("Not yet implemented")}listCheckpoints(e){return Promise.resolve([])}restoreCheckpoint(e,t){return Promise.reject("Not yet implemented")}deleteCheckpoint(e,t){return Promise.reject("Read only")}jupyterPathToS3Path(e,t){return""===e?e="/":t&&(e+="/"),console.log(`path: ${e}`),e}s3ToJupyterContents(e){return{name:e.name,path:e.path,format:"json",type:e.type,created:"",writable:!1,last_modified:"",mimetype:e.mimetype,content:e.content}}pathToJupyterContents(e){let t;return e!==o.currentPath&&"file"!==o.availableContentTypes[e]&&o.showingError&&o.hideErrorMessage(),"file"!==o.availableContentTypes[e]?(o.currentPath=e,t=this.jupyterPathToS3Path(e,!0)):t=this.jupyterPathToS3Path(e,!1),new Promise(((r,s)=>{const n=d.ServerConnection.makeSettings();console.log(`s3path: ${t}`);var i=`${n.baseUrl}/jupyterlab_s3_browser/files/${t}`;console.log(`completePath: ${i}`),console.log(`urlext: ${l.URLExt.join(n.baseUrl,"jupyterlab_s3_browser/files",t)}`),d.ServerConnection.makeRequest(l.URLExt.join(n.baseUrl,"jupyterlab_s3_browser/files",t),{},n).then((t=>{t.json().then((t=>{if(t.error){const e=`Server returned status code ${t.error}. Error message: ${t.message}.`;return console.error(e),o.showErrorMessage(e),s(e),[]}if(Array.isArray(t))t.forEach((e=>{o.availableContentTypes[e.path]=e.type})),r({type:"directory",path:e.trim(),name:"",format:"json",content:t.map((e=>this.s3ToJupyterContents(e))),created:"",writable:!1,last_modified:"",mimetype:""});else{const s=this._registry.getFileTypesForPath(e),n=0===s.length?this._registry.getFileType("text"):s[0],i=n.mimeTypes[0],a=n.fileFormat;let c;switch(a){case"text":c=o.b64DecodeUTF8(t.content);break;case"base64":c=t.content;break;case"json":c=JSON.parse(o.b64DecodeUTF8(t.content));break;default:throw new Error(`Unexpected file format: ${n.fileFormat}`)}r({type:"file",path:e,name:"",format:a,content:c,created:"",writable:!1,last_modified:"",mimetype:i})}})).then((e=>(""===o.currentPath?document.querySelector("#s3-filebrowser").classList.add("root"):document.querySelector("#s3-filebrowser").classList.remove("root"),e)))}))}))}}!function(e){const t=new TextDecoder("utf8");e.b64DecodeUTF8=function(e){const r=u.toByteArray(e.replace(/\n/g,""));return t.decode(r)},e.availableContentTypes={},e.showingError=!1,e.showErrorMessage=function(t){const r=document.querySelector("#s3-filebrowser > .jp-DirListing");r.insertAdjacentHTML("afterend",`<div class="s3-error"><p>${t}</p></div>`),r.style.display="none",e.showingError=!0},e.hideErrorMessage=function(){document.querySelector("#s3-filebrowser > .jp-DirListing").style.display="block",document.querySelector(".s3-error")&&document.querySelector(".s3-error").remove(),e.showingError=!1},e.showDirectoryLoadingSpinner=function(){if(console.log("showing loading spinner"),document.querySelector("#s3-spinner"))return;document.querySelector("#s3-filebrowser").classList.add("loading");const e=document.querySelector("#s3-filebrowser .jp-DirListing-content"),t=document.createElement("div");t.classList.add("jp-SpinnerContent"),t.id="s3-spinner",e.appendChild(t)},e.hideDirectoryLoadingSpinner=function(){console.log("trying to hide loading spinner");const e=document.querySelector("#s3-spinner");document.querySelector("#s3-filebrowser").classList.remove("loading");try{e.remove()}catch(e){console.log(e)}}}(o||(o={}));var m=r(510),p=r(462),y=r(441);let g;class b extends m.Widget{constructor(e,t,r){super(),this.addClass("jp-S3Browser"),this.layout=new m.PanelLayout;const o=()=>{const t=document.querySelector("#s3form"),r=new FormData(t),o={};r.forEach(((e,t)=>{o[t]=e}));const s=d.ServerConnection.makeSettings();d.ServerConnection.makeRequest(l.URLExt.join(s.baseUrl,"jupyterlab_s3_browser/auth"),{method:"POST",body:JSON.stringify(o)},s).then((t=>{t.json().then((t=>{if(t.success)this.layout.removeWidget(g),this.layout.addWidget(e),e.model.refresh();else{let e=t.message;e.includes("InvalidAccessKeyId")?e="The access key ID you entered was invalid.":e.includes("SignatureDoesNotMatch")&&(e="The secret access key you entered was invalid"),(0,y.showErrorMessage)("S3 Authentication Error",Error(e))}}))}))};f.checkIfAuthenicated().then((t=>{console.log("Checking if authenticated"),t?(this.layout.addWidget(e),console.log("refreshing"),e.model.refresh()):(g=new m.Widget({node:f.createS3AuthenticationForm(o)}),this.layout.addWidget(g))}))}}var f;!function(e){e.createS3AuthenticationForm=function(e){return p.VirtualDOM.realize(p.h.div({className:"s3form"},p.h.h4("S3 Object Storage Browser"),p.h.div("This extension allows you to browse S3-compatible object storage instances, such as AWS S3 and IBM Cloud Object Storage."),p.h.br(),p.h.form({id:"s3form",method:"post"},p.h.p(p.h.label({},"Endpoint URL"),p.h.br(),p.h.input({type:"url",name:"endpoint_url"})),p.h.br(),p.h.p(p.h.label({},"Access Key ID"),p.h.br(),p.h.input({type:"text",name:"client_id"})),p.h.br(),p.h.p(p.h.label({},"Secret Access Key"),p.h.br(),p.h.input({type:"password",name:"client_secret"}))),p.h.br(),p.h.p({className:"s3-connect"},p.h.button({onclick:e,className:"jp-mod-accept jp-mod-styled"},"Connect"))))},e.checkIfAuthenicated=function(){return new Promise(((e,t)=>{const r=d.ServerConnection.makeSettings();d.ServerConnection.makeRequest(l.URLExt.join(r.baseUrl,"jupyterlab_s3_browser/auth"),{method:"GET"},r).then((t=>{t.json().then((t=>{e(t.authenticated)}))}))}))}}(f||(f={}));const w="s3-filebrowser",S={id:"jupyterlab-s3-browser:drive",requires:[i.IDocumentManager,a.IFileBrowserFactory,s.ILayoutRestorer,n.ISettingRegistry],activate:function(e,t,r,o,s){const n=new h(e.docRegistry);t.services.contents.addDrive(n);const i=r.createFileBrowser(w,{driveName:n.name,state:null,refreshInterval:3e5}),a=new b(i,n,t);return a.title.iconClass="jp-S3-icon jp-SideBar-tabIcon",a.title.caption="Object Storage Browser",a.id="s3-file-browser",o.add(a,w),void e.shell.add(a,"left",{rank:100})},autoStart:!0}}}]);