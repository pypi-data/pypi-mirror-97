var __awaiter=this&&this.__awaiter||function(e,t,i,n){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function r(e){try{l(n["throw"](e))}catch(t){s(t)}}function l(e){e.done?i(e.value):o(e.value).then(a,r)}l((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:r(0),throw:r(1),return:r(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function r(e){return function(t){return l([e,t])}}function l(a){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,o&&(s=a[0]&2?o["return"]:a[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,a[1])).done)return s;if(o=0,s)a=[a[0]&2,s.value];switch(a[0]){case 0:case 1:s=a;break;case 4:i.label++;return{value:a[1],done:false};case 5:i.label++;o=a[1];a=[0];continue;case 7:a=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){i=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){i.label=a[1];break}if(a[0]===6&&i.label<s[1]){i.label=s[1];s=a;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(a);break}if(s[2])i.ops.pop();i.trys.pop();continue}a=t.call(e,i)}catch(r){a=[6,r];o=0}finally{n=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};System.register(["./p-6089d0c4.system.js","./p-f4e56c2a.system.js","./p-1c3f461e.system.js","./p-90ea9d99.system.js"],(function(e){"use strict";var t,i,n,o,s,a,r,l,c,u;return{setters:[function(e){t=e.r;i=e.c;n=e.h;o=e.g},function(e){s=e.E},function(e){a=e.f;r=e.a;l=e.b;c=e.r},function(e){u=e.w}],execute:function(){var d="limel-dialog{--dialog-heading-icon-background-color:#f49132}limel-dialog .ga-body{overflow:auto;min-height:-webkit-min-content;min-height:-moz-min-content;min-height:min-content;margin-top:1rem}limel-dialog .ga-top-bar{position:-webkit-sticky;position:sticky;top:0;height:5rem;background-color:#fff;z-index:4;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;z-index:9}@media (min-width: 1074px){limel-dialog{--dialog-width:65rem;--dialog-height:40rem}}@media (max-width: 1075px){limel-dialog{--dialog-width:55rem;--dialog-height:40rem}}@media (min-width: 1800px){limel-dialog{--dialog-width:70rem;--dialog-height:60rem}}limel-button{--lime-primary-color:#f49132}.logo-container{height:2.2rem;width:10rem;margin-bottom:1rem;cursor:pointer;-webkit-transition:width 0.5s;transition:width 0.5s;overflow:hidden}.logo-container.compact{width:2.8rem}.logo-container:hover{opacity:0.8}.logo-container .logo{height:2.2rem}.close{display:block;position:absolute;right:-1rem;top:0rem;cursor:pointer}.close:hover{color:#eee}.actionpad-container{width:100%}.getaccept-button{width:100%;display:-ms-flexbox;display:flex;-ms-flex-pack:start;justify-content:start;-ms-flex-align:center;align-items:center;padding:0.425rem 0.875rem 0.425rem 0.875rem;border:none;border-radius:2rem;cursor:pointer;-webkit-transition:background 0.8s;transition:background 0.8s;background-position:center;font-size:0.8rem;font-weight:bold;color:#444;background:#eee}.getaccept-button:focus{outline:0}.getaccept-button:hover{background:#f5f5f5 radial-gradient(circle, transparent 1%, #f5f5f5 1%) center/15000%}.getaccept-button:active{background-color:white;background-size:100%;-webkit-transition:background 0s;transition:background 0s}.getaccept-button img{height:2rem;-ms-flex:0;flex:0}.getaccept-button .button-text{margin-left:0.5rem;-ms-flex:2;flex:2;text-align:left}.getaccept-button .document-count{margin-left:auto;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.getaccept-button .document-count limel-icon{margin-right:0.3rem}workflow-progress-bar{position:absolute;top:1.5rem;left:4rem;right:4rem}";var m=e("lwc_getaccept_root",function(){function e(e){t(this,e);this.errorHandler=i(this,"errorHandler",7);this.isOpen=false;this.entities=[];this.activeView=s.login;this.errorMessage="";this.documents=[];this.isSending=false;this.openDialog=this.openDialog.bind(this);this.handleLogoClick=this.handleLogoClick.bind(this);this.renderLayout=this.renderLayout.bind(this);this.loadInitialData=this.loadInitialData.bind(this);this.loadSentDocuments=this.loadSentDocuments.bind(this);this.showWorkflow=this.showWorkflow.bind(this)}e.prototype.componentWillLoad=function(){this.externalId=this.context.limetype+"_"+this.context.id;this.activeView=this.checkIfSessionExists?s.home:s.login;if(this.session){this.loadInitialData()}this.setDefaultDocumentData()};e.prototype.loadInitialData=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,i,n;return __generator(this,(function(o){switch(o.label){case 0:this.loadSentDocuments();o.label=1;case 1:o.trys.push([1,3,,4]);return[4,a(this.platform,this.session)];case 2:e=o.sent(),t=e.user,i=e.entities;this.user=t;this.entities=i;return[3,4];case 3:n=o.sent();this.errorHandler.emit("Could not load user session. Try relogging");return[3,4];case 4:this.loadEntityDetails();return[2]}}))}))};e.prototype.loadEntityDetails=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:i.trys.push([0,2,,3]);return[4,r(this.platform,this.session)];case 1:e=i.sent().entity;this.session.entity_id=e.id;this.documentData.email_send_message=e.email_send_message!==""?e.email_send_message:e.default_email_send_message;this.documentData.email_send_subject=e.email_send_subject!==""?e.email_send_subject:e.default_email_send_subject;return[3,3];case 2:t=i.sent();this.errorHandler.emit("Could not load user session. Try relogging");return[3,3];case 3:return[2]}}))}))};e.prototype.render=function(){var e=this;return[n("limel-flex-container",{class:"actionpad-container"},n("button",{class:"getaccept-button",onClick:this.openDialog},n("img",{src:"getaccept/logos/logo_only"}),n("span",{class:"button-text"},"Send document"),this.renderDocumentCount(!!this.session))),n("limel-dialog",{open:this.isOpen,closingActions:{escapeKey:true,scrimClick:false},onClose:function(){e.isOpen=false}},n("div",{class:"ga-top-bar"},this.renderLogo(this.showWorkflow()),function(){if(e.activeView!==s.login){return[n("limel-icon",{class:"close",name:"cancel",size:"small",onClick:function(){e.isOpen=false}}),n("layout-menu",{activeView:e.activeView,isSending:e.isSending}),n("workflow-progress-bar",{isVisible:e.showWorkflow(),activeView:e.activeView})]}}()),n("div",{class:"ga-body"},this.renderLayout()),n("limel-button-group",{slot:"button"},n("limel-button",{label:"Cancel",onClick:function(){e.isOpen=false}})),n("error-message",{error:this.errorMessage}))]};e.prototype.renderDocumentCount=function(e){if(e){return n("span",{class:"document-count"},n("limel-icon",{name:"file",size:"small"}),n("span",null,this.documents.length))}return[]};e.prototype.renderLogo=function(e){var t="logo-container "+(e?"compact":"");return n("div",{class:t},n("img",{onClick:this.handleLogoClick,src:"getaccept/logos/logo-inverted",class:"logo"}))};e.prototype.showWorkflow=function(){var e=this;if(this.isSending||this.isSealed){return false}return u.some((function(t){return t.currentView===e.activeView}))};e.prototype.renderLayout=function(){switch(this.activeView){case s.home:return n("layout-overview",{platform:this.platform,session:this.session,externalId:this.externalId,documents:this.documents});case s.login:return n("layout-login",{platform:this.platform});case s.selectFile:return n("layout-select-file",{platform:this.platform,session:this.session,context:this.context,selectedLimeDocument:this.limeDocument,selectedTemplate:this.template,customFields:this.templateFields});case s.recipient:return n("layout-select-recipient",{platform:this.platform,document:this.documentData});case s.settings:return n("layout-settings",{user:this.user,entities:this.entities,session:this.session,platform:this.platform});case s.help:return n("layout-help",null);case s.sendDocument:return n("layout-send-document",{document:this.documentData,limeDocument:this.limeDocument,template:this.template});case s.videoLibrary:return n("layout-video-library",{platform:this.platform,session:this.session});case s.documentDetail:return n("layout-document-details",{platform:this.platform,session:this.session,documentId:this.documentId});case s.documentValidation:return n("layout-validate-document",{platform:this.platform,session:this.session,document:this.documentData,limeDocument:this.limeDocument,template:this.template,fields:this.templateFields,isSealed:this.isSealed,isSending:this.isSending});default:return n("layout-overview",null)}};e.prototype.logout=function(){localStorage.removeItem("getaccept_session");this.documents=[];this.activeView=s.login};e.prototype.openDialog=function(){this.isOpen=true};e.prototype.handleLogoClick=function(){this.activeView=this.checkIfSessionExists?s.home:s.login};e.prototype.loadSentDocuments=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:this.isLoadingDocuments=true;i.label=1;case 1:i.trys.push([1,3,,4]);e=this;return[4,l(this.platform,this.externalId,this.session)];case 2:e.documents=i.sent();return[3,4];case 3:t=i.sent();this.errorHandler.emit("Something went wrong while documents from GetAccept...");return[3,4];case 4:this.isLoadingDocuments=false;return[2]}}))}))};e.prototype.changeViewHandler=function(e){if(e.detail===s.logout){this.logout()}else if(this.isSealed){this.activeView=s.home;this.setDefaultDocumentData()}else{this.activeView=e.detail}};e.prototype.setTemplate=function(e){this.template=e.detail;this.documentData.name=e.detail.text;this.limeDocument=null;this.templateFields=[]};e.prototype.setLimeDocument=function(e){this.limeDocument=e.detail;this.template=null;this.templateFields=[]};e.prototype.setCustomFields=function(e){this.templateFields=e.detail};e.prototype.updateDocumentRecipientHandler=function(e){this.documentData.recipients=e.detail};e.prototype.documentTypeHandler=function(e){this.documentData.is_signing=e.detail};e.prototype.setSessionHandler=function(e){this.setSessionData(e.detail);this.activeView=s.home;this.loadInitialData()};e.prototype.setDocumentName=function(e){this.documentData=Object.assign(Object.assign({},this.documentData),{name:e.detail})};e.prototype.setDocumentValue=function(e){this.documentData=Object.assign(Object.assign({},this.documentData),{value:e.detail})};e.prototype.setDocumentSmartReminder=function(e){this.documentData.is_reminder_sending=e.detail};e.prototype.setDocumentIsSmsSending=function(e){this.documentData.is_sms_sending=e.detail};e.prototype.setDocumentEmailSubject=function(e){this.documentData.email_send_subject=e.detail};e.prototype.setDocumentEmailMessage=function(e){this.documentData.email_send_message=e.detail};e.prototype.validateDocumentHandler=function(){this.activeView=s.documentValidation};e.prototype.openDocumentDetails=function(e){this.activeView=s.documentDetail;this.documentId=e.detail.id};e.prototype.setDocumentVideo=function(e){this.documentData.video_id=e.detail;this.documentData.is_video=true};e.prototype.removeDocumentVideo=function(){this.documentData.video_id="";this.documentData.is_video=false};e.prototype.setIsSending=function(e){this.isSending=e.detail};e.prototype.documentCompleted=function(e){this.setDefaultDocumentData();this.loadEntityDetails();this.isSealed=e.detail;if(!this.isSealed){this.activeView=s.home}this.loadSentDocuments()};e.prototype.onError=function(e){var t=this;this.errorMessage=e.detail;setTimeout((function(){return t.errorMessage=""}),100)};Object.defineProperty(e.prototype,"checkIfSessionExists",{get:function(){var e=window.localStorage.getItem("getaccept_session");if(!!e){var t=JSON.parse(e);this.validateToken(t);this.session=t}return!!e},enumerable:false,configurable:true});e.prototype.validateToken=function(e){return __awaiter(this,void 0,void 0,(function(){var t,i,n,o,s;var a=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,c(this.platform,e)];case 1:t=r.sent(),i=t.data,n=t.success;if(n){o=window.localStorage.getItem("getaccept_session");if(!!o){s=JSON.parse(o);s.expires_in=i.expires_in;s.access_token=i.access_token;this.setSessionData(s)}}else{this.errorMessage="Could not refresh token.";setTimeout((function(){return a.errorMessage=""}))}return[2,true]}}))}))};e.prototype.setSessionData=function(e){window.localStorage.setItem("getaccept_session",JSON.stringify(e));this.session=e};e.prototype.setDefaultDocumentData=function(){this.documentData={is_signing:false,name:"",recipients:[],template_id:"",custom_fields:[],is_reminder_sending:false,is_sms_sending:false,email_send_subject:"",email_send_message:"",video_id:"",is_video:false,external_id:this.externalId,value:0};this.templateFields=[];this.isSealed=false;this.template=null;this.limeDocument=null};Object.defineProperty(e.prototype,"element",{get:function(){return o(this)},enumerable:false,configurable:true});return e}());m.style=d}}}));