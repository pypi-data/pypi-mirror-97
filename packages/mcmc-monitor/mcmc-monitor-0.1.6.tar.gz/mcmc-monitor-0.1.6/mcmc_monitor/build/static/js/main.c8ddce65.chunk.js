(this["webpackJsonpmcmc-monitor"]=this["webpackJsonpmcmc-monitor"]||[]).push([[0],{137:function(e,t,n){},143:function(e,t,n){},144:function(e,t,n){},166:function(e,t,n){"use strict";n.r(t);var r=n(9),c=n(0),i=n(12),o=n.n(i),a=n(75),s=n(15),u=n(101),l=n.n(u),j=n(8),b=(n(137),n(2));var d=function(){var e=Object(r.e)().filter((function(e){return"MainWindow"===e.name}))[0];if(!e)throw Error("Unable to find main window plugin.");var t=Object(c.useContext)(r.c).serverInfo,n=Object(j.e)(),i=Object(j.d)(),o=Object(c.useMemo)((function(){var e=l.a.parse(n.search.slice(1)).workspace||"default",r=null===t||void 0===t?void 0:t.defaultFeedId;return e.startsWith("workspace://")?e:r?"workspace://".concat(r,"/").concat(e):void 0}),[n.search,t]),a=Object(c.useMemo)((function(){return n.pathname.startsWith("/run/")?{page:"run",runId:n.pathname.split("/")[2]||""}:{page:"main"}}),[n.pathname]),u=Object(c.useCallback)((function(e){var t=function(e,t){return"gotoPage"===t.type?t.page:e}(a,e),r="/";r="main"===t.page?"/":"run"===t.page?"/run/".concat(t.runId):"/",n.pathname!==r&&i.push(Object(s.a)(Object(s.a)({},n),{},{pathname:r}))}),[a,i,n]);return Object(b.jsx)("div",{className:"App",children:Object(b.jsx)("header",{className:"App-header",children:Object(b.jsx)(e.component,{workspaceUri:o,workspaceRoute:a,workspaceRouteDispatch:u})})})},f=n(64),p=(n(143),n(13)),O=n(187),h=n(190),m=n(191),x=n(192),k=n(193),v=n(206),w=n(167),g=n(194),y=n(195),C=(n(144),function(e){var t=e.title,n=e.rowKey,r=e.onDeleteRow,i=Object(c.useCallback)((function(){r&&r(n)}),[r,n]);return Object(b.jsx)(w.a,{title:t,onClick:i,children:Object(b.jsx)(g.a,{})})}),I=function(e){var t=e.title,n=e.rowKey,r=e.onConfirmDeleteRow,i=Object(c.useCallback)((function(){r&&r(n,!0)}),[r,n]),o=Object(c.useCallback)((function(){r&&r(n,!1)}),[r,n]);return Object(b.jsxs)("span",{children:["Confirm delete?",Object(b.jsx)(w.a,{title:t,onClick:i,children:Object(b.jsx)(g.a,{})}),Object(b.jsx)(w.a,{title:"Cancel",onClick:o,children:"\u2716"})]})},R=function(e){var t=e.title,n=e.rowKey,r=e.onEditRow;return Object(b.jsx)(w.a,{title:t,onClick:function(){return r&&r(n)},children:Object(b.jsx)(y.a,{})})},M=function(e){return 0==e?e:e?"object"==typeof e?e.element?e.element:e.text||"":e:""},D=function(e){var t=e.rows,n=e.columns,r=e.onDeleteRow,i=void 0===r?void 0:r,o=e.deleteRowLabel,a=void 0===o?void 0:o,s=e.onEditRow,u=void 0===s?void 0:s,l=e.editRowLabel,j=void 0===l?void 0:l,d=e.selectionMode,f=void 0===d?"none":d,w=e.selectedRowKeys,g=void 0===w?{}:w,y=e.onSelectedRowKeysChanged,D=void 0===y?void 0:y,N=e.noConfirmDeleteRow,S=Object(c.useMemo)((function(){var e={};return Object.keys(g).forEach((function(t){e[t]=g[t]})),e}),[g]),U=Object(c.useState)(null),E=Object(p.a)(U,2),P=E[0],W=E[1],J=Object(c.useCallback)((function(e){D&&("single"===f?e in S&&S[e]?D([]):D([e+""]):"multiple"===f&&D(Object.keys(S).filter((function(t){return t!=e&&S[t]})).concat(S[e]?[]:[e.toString()])))}),[D,f,S]),V=Object(c.useCallback)((function(e,t){t&&i&&i(e),W(null)}),[i]),K=Object(c.useCallback)((function(e){N?V(e,!0):W(e)}),[N,V]),T=Object(c.useCallback)((function(e){u&&u(e)}),[u]);return Object(b.jsxs)(O.a,{className:"NiceTable",children:[Object(b.jsx)(h.a,{children:Object(b.jsxs)(m.a,{children:[Object(b.jsx)(x.a,{style:{width:0}},"_first"),n.map((function(e){return Object(b.jsx)(x.a,{children:Object(b.jsx)("span",{children:e.label})},e.key)}))]})}),Object(b.jsx)(k.a,{children:t.map((function(e){return Object(b.jsxs)(m.a,{children:[Object(b.jsxs)(x.a,{children:[i&&(P===e.key?Object(b.jsx)(I,{title:a||"",onConfirmDeleteRow:V,rowKey:e.key}):Object(b.jsx)(C,{title:a||"",onDeleteRow:K,rowKey:e.key})),u&&Object(b.jsx)(R,{title:j||"",onEditRow:T,rowKey:e.key}),"none"!==f&&Object(b.jsx)(v.a,{checked:S[e.key]||!1,onClick:function(){return J(e.key)}})]}),n.map((function(t){return Object(b.jsx)(x.a,{children:Object(b.jsx)("span",{children:M(e.columnValues[t.key])})},t.key)}))]},e.key)}))})]})},N=function(e){var t=e.iterations,n=Object(c.useMemo)((function(){var e={};return t.forEach((function(t){var n=t.chainId;n+""in e?e[n+""].iterationCount++:e[n+""]={iterationCount:1}})),Object.keys(e).sort().map((function(e){return Number(e)})).map((function(t){return Object(s.a)({chainId:t},e[t+""])}))}),[t]),r=Object(c.useMemo)((function(){return n.map((function(e,t){var n={chainId:e.chainId+"",iterationCount:e.iterationCount};return{key:e.chainId+"",columnValues:n}}))}),[n]),i=Object(c.useMemo)((function(){return[{key:"chainId",label:"Chain"},{key:"iterationCount",label:"Num. iterations"}]}),[]);return Object(b.jsx)(D,{rows:r,columns:i})},S=function(e){e.run;var t=e.iterations;return Object(b.jsx)(N,{iterations:t||[]})};var U=n(207),E=n(196),P=n(197),W=function(e){return Object(b.jsxs)(U.a,{TransitionProps:{unmountOnExit:void 0===e.unmountOnExit||e.unmountOnExit},defaultExpanded:e.defaultExpanded,children:[Object(b.jsxs)(E.a,{children:[e.icon&&Object(b.jsx)("span",{style:{paddingRight:10},children:e.icon}),Object(b.jsx)("span",{style:{paddingTop:3},children:e.label})]}),Object(b.jsx)(P.a,{children:Object(b.jsx)("div",{style:{width:"100%"},children:e.children})})]})},J=n(18),V=n(26),K=(n(165),function(e){for(var t=Object(J.a)(e),n=1;n<e.length;n++)t[n]=t[n-1]+(e[n]-t[n-1])/n;return t}),T=function(e){return function(e){var t=K(e),n=Object(J.a)(e);n[0]=0;for(var r=1;r<e.length;r++)n[r]=n[r-1]+(e[r]-t[r-1])*(e[r]-t[r]);return n.map((function(e,t){return t>0?e/t:0}))}(e).map((function(e){return Math.sqrt(e)}))},F=function(e){var t=e.iterations,n=e.paramKey,r=e.markerColor,i=t[0],o=Object(c.useMemo)((function(){return i?Object.keys(i.parameters||{}):[]}),[i]);if(!o.includes(n))return Object(b.jsxs)("div",{children:["Not found: ",n," ",Object(b.jsx)("pre",{children:JSON.stringify(o)})]});var a=t.map((function(e){return e.parameters[n]})),s=K(a),u=T(a),l=a.map((function(e,t){return{x:t,y:e}})),j=s.map((function(e,t){return{x:t,y:e}})),d=u.map((function(e,t){return{x:t,y:s[t]+e}})),f=u.map((function(e,t){return{x:t,y:s[t]-e}}));return Object(b.jsxs)(V.e,{margin:70,height:400,width:1e3,children:[Object(b.jsx)(V.b,{data:j,stroke:"blue"}),Object(b.jsx)(V.b,{data:f,stroke:"pink",strokeStyle:"dashed"}),Object(b.jsx)(V.b,{data:d,stroke:"pink",strokeStyle:"dashed"}),Object(b.jsx)(V.c,{data:l,fill:"none",stroke:r,strokeWidth:1}),Object(b.jsx)(V.a,{text:"".concat(n," vs iteration"),xPercent:.5,yPercent:-.05}),Object(b.jsx)(V.d,{title:"Iteration number"}),Object(b.jsx)(V.f,{title:n})]})},L=function(e){e.run;var t=e.iterations,n=Object(c.useMemo)((function(){var e={};return(t||[]).forEach((function(t){var n=t.chainId;n+""in e?e[n+""].iterations.push(t):e[n+""]={iterations:[]}})),Object.keys(e).sort().map((function(e){return Number(e)})).map((function(t){return Object(s.a)({chainId:t},e[t+""])}))}),[t]);return Object(b.jsx)("div",{children:n.map((function(e){return Object(b.jsx)(W,{label:"Iterations plot for chain ".concat(e.chainId),unmountOnExit:!0,children:Object(b.jsxs)("div",{children:[Object(b.jsx)(F,{iterations:e.iterations,paramKey:"energy__",markerColor:"darkgreen"}),Object(b.jsx)(F,{iterations:e.iterations,paramKey:"lp__",markerColor:"darkblue"})]})},e.chainId)}))})};var B=n(31),_=function(e){return new Date(1e3*e).toISOString()},A=function(e){var t=e.iterations,n=t[0],r=Object(c.useMemo)((function(){return n?Object.keys(n.parameters||{}):[]}),[n]),i=Object(c.useMemo)((function(){return t.map((function(e,t){var n,c={timestamp:_(e.timestamp),chainId:e.chainId+""},i=Object(B.a)(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;c["param-"+o]=e.parameters[o]}}catch(a){i.e(a)}finally{i.f()}return{key:t+"",columnValues:c}}))}),[t,r]),o=Object(c.useMemo)((function(){return[{key:"chainId",label:"Chain"},{key:"timestamp",label:"Timestamp"}].concat(Object(J.a)(r.map((function(e){return{key:"param-"+e,label:e}}))))}),[r]);return Object(b.jsx)(D,{rows:i,columns:o})},q=function(e){e.run;var t=e.iterations,n=Object(c.useMemo)((function(){var e={};return(t||[]).forEach((function(t){var n=t.chainId;n+""in e?e[n+""].iterations.push(t):e[n+""]={iterations:[]}})),Object.keys(e).sort().map((function(e){return Number(e)})).map((function(t){return Object(s.a)({chainId:t},e[t+""])}))}),[t]);return Object(b.jsx)("div",{children:n.map((function(e){return Object(b.jsx)(W,{label:"Iterations table for chain ".concat(e.chainId),unmountOnExit:!0,children:Object(b.jsx)("div",{style:{height:300,overflow:"auto"},children:Object(b.jsx)(A,{iterations:e.iterations})})},e.chainId)}))})};var H=n(205),z=function(e){if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};var t=e.split("/"),n=t[2]||void 0,r=t[3]||void 0;return n&&r?{feedUri:"feed://".concat(n),workspaceName:r}:{feedUri:void 0,workspaceName:void 0}},G=function(e,t){return"AddRun"===t.type?Object(s.a)(Object(s.a)({},e),{},{runs:[].concat(Object(J.a)(e.runs),[t.run])}):"DeleteRuns"===t.type?Object(s.a)(Object(s.a)({},e),{},{runs:e.runs.filter((function(e){return!t.runIds.includes(e.runId)}))}):e},Q=n(202),X=n(203),Y=function(){var e=Object(c.useState)([]),t=Object(p.a)(e,2),n=t[0],i=t[1],o=Object(c.useContext)(r.a);Object(c.useEffect)((function(){var e=setInterval((function(){var e=o.getHitherJobs();i(e)}),1e3);return function(){clearInterval(e)}}),[o]);var a={pendingJobs:n.filter((function(e){return"pending"===e.status})),runningJobs:n.filter((function(e){return"running"===e.status})),finishedJobs:n.filter((function(e){return"finished"===e.status})),erroredJobs:n.filter((function(e){return"error"===e.status}))},s=a.runningJobs,u=a.finishedJobs,l=a.erroredJobs,j=a.pendingJobs.length,d=s.length,f=u.length,O=l.length,h="Jobs: ".concat(j," pending | ").concat(d," running | ").concat(f," finished | ").concat(O," errored"),m=O>0?Object(b.jsxs)("span",{children:[":",Object(b.jsx)("span",{style:{color:"pink"},children:O})]}):Object(b.jsx)("span",{});return Object(b.jsxs)("span",{title:h,style:{fontFamily:"courier"},children:[j,":",d,":",f,m]})},Z=n.p+"static/media/logo.e906eb4b.svg",$=n(198),ee=n(199),te=n(200),ne=function(){var e=Object(c.useContext)(r.c),t=e.websocketStatus,n=e.onReconnectWebsocket,i=Object(c.useMemo)((function(){switch(t){case"waiting":return{icon:Object(b.jsx)($.a,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:Object(b.jsx)(ee.a,{style:{color:""}}),title:"Connected"};case"disconnected":return{icon:Object(b.jsx)(te.a,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[t]),o=i.icon,a=i.title,s=Object(c.useCallback)((function(){"disconnected"===t&&n()}),[t,n]);return Object(b.jsx)(w.a,{title:a,onClick:s,children:o})},re=n(201),ce=function(e){var t=e.onOpenSettings,n=Object(c.useMemo)((function(){return{icon:Object(b.jsx)(re.a,{}),title:"Open settings"}}),[]),r=n.icon,i=n.title,o=Object(c.useCallback)((function(){t()}),[t]);return Object(b.jsx)(w.a,{title:i,onClick:o,children:r})},ie=function(e){var t=e.onOpenSettings;return Object(b.jsx)(Q.a,{position:"static",style:{height:50,background:"#d85636"},children:Object(b.jsxs)(X.a,{children:[Object(b.jsx)("img",{src:Z,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:15}}),"\xa0",Object(b.jsx)("span",{style:{paddingBottom:10,color:"#312a00",fontFamily:"sans-serif",fontWeight:"bold"},children:"MCMC Monitor"}),Object(b.jsx)("span",{style:{marginLeft:"auto"}}),Object(b.jsxs)("span",{style:{paddingBottom:15,color:"#312a00"},children:[Object(b.jsx)(ce,{onOpenSettings:t}),Object(b.jsx)(ne,{}),Object(b.jsx)(Y,{})]})]})})},oe=n(204),ae=Object(oe.a)((function(e){return{paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}})),se=function(e){var t=e.workspaceUri,n=ae(),i=Object(c.useContext)(r.c).serverInfo,o=z(t),a=(o.feedUri,o.workspaceName);return Object(b.jsxs)("div",{className:n.paper,children:[Object(b.jsx)("h2",{children:"MCMC Monitor 0.1.6"}),Object(b.jsxs)(O.a,{children:[Object(b.jsxs)(m.a,{children:[Object(b.jsx)(x.a,{children:"Workspace URI"}),Object(b.jsx)(x.a,{children:t||""})]}),Object(b.jsxs)(m.a,{children:[Object(b.jsx)(x.a,{children:"Workspace name"}),Object(b.jsx)(x.a,{children:a})]}),Object(b.jsxs)(m.a,{children:[Object(b.jsx)(x.a,{children:"Kachery node ID"}),Object(b.jsx)(x.a,{children:i?i.nodeId:""})]}),Object(b.jsxs)(m.a,{children:[Object(b.jsx)(x.a,{children:"Default feed ID"}),Object(b.jsx)(x.a,{children:i?i.defaultFeedId:""})]})]})]})},ue=function(e){var t=e.workspaceUri,n=e.workspaceRoute,i=e.workspaceRouteDispatch,o=function(){var e=Object(r.e)();return Object(c.useMemo)((function(){return e.filter((function(e){return"WorkspaceView"===e.type})).map((function(e){return e}))}),[e])}().filter((function(e){return"WorkspaceView"===e.name}))[0];if(!o)throw Error("Unable to find workspace view plugin");var a=Object(c.useState)(!1),s=Object(p.a)(a,2),u=s[0],l=s[1],j=Object(c.useReducer)(G,{runs:[]}),d=Object(p.a)(j,2),f=d[0],O=d[1],h=Object(c.useCallback)((function(e){e.forEach((function(e){return O(e)}))}),[]),m=z(t),x=m.feedUri,k=m.workspaceName,v=Object(c.useMemo)((function(){return{workspaceName:k}}),[k]),w=Object(r.f)({feedUri:x,subfeedName:v,onMessages:h}).appendMessages,g=Object(c.useCallback)((function(e){w([e])}),[w]),y=Object(c.useCallback)((function(){l(!0)}),[]),C=Object(c.useCallback)((function(){l(!1)}),[]);return Object(b.jsxs)("div",{style:{margin:0},children:[Object(b.jsx)(ie,{onOpenSettings:y}),Object(b.jsx)("div",{style:{margin:30},children:Object(b.jsx)(o.component,{workspace:f,workspaceDispatch:g,workspaceRoute:n,workspaceRouteDispatch:i})}),Object(b.jsx)(H.a,{open:u,onClose:C,children:Object(b.jsx)("span",{children:Object(b.jsx)(se,{workspace:f,workspaceUri:t})})})]})};var le=function(e){return Object(b.jsx)("span",{style:{color:"gray",cursor:"pointer",textDecoration:"underline"},onClick:e.onClick,children:e.children})},je=function(e){var t=e.run,n=e.onClick,r=Object(c.useCallback)((function(){n(t)}),[n,t]);return Object(b.jsx)(le,{onClick:r,children:t.runLabel})},be=function(e){var t=e.workspace,n=e.workspaceDispatch,r=e.workspaceRouteDispatch,i=Object(c.useCallback)((function(e){r({type:"gotoPage",page:{page:"run",runId:e.runId}})}),[r]),o=Object(c.useMemo)((function(){return t.runs.slice().reverse().map((function(e){return{key:e.runId,columnValues:{label:{text:e.runLabel,element:Object(b.jsx)("span",{style:{marginRight:5,whiteSpace:"nowrap"},children:Object(b.jsx)(je,{run:e,onClick:i})})},uri:e.uri}}}))}),[t.runs,i]),a=Object(c.useMemo)((function(){return[{key:"label",label:"Run"},{key:"uri",label:"URI"}]}),[]),s=Object(c.useCallback)((function(e){n({type:"DeleteRuns",runIds:[e]})}),[n]);return Object(b.jsx)("div",{children:Object(b.jsx)(D,{rows:o,columns:a,onDeleteRow:s,noConfirmDeleteRow:!0})})},de=function(e){var t=e.workspace,n=e.runId,i=e.workspaceRouteDispatch,o=Object(c.useMemo)((function(){return t.runs.filter((function(e){return e.runId===n}))[0]}),[n,t.runs]),a=function(e){if(!e)return{feedUri:void 0,subfeedName:void 0};var t=e.split("/");return{feedUri:t.slice(0,3).join("/"),subfeedName:t[3]}}(null===o||void 0===o?void 0:o.uri),s=a.feedUri,u=a.subfeedName,l=Object(r.f)({feedUri:s,subfeedName:u}),j=l.messages,d=l.loadedInitialMessages,f=Object(c.useMemo)((function(){return d?j.filter((function(e){return function(e){try{return!("iteration"!==e.type||!e.timestamp||!e.chainId)}catch(t){return!1}}(e)})):void 0}),[j,d]),p=Object(c.useCallback)((function(){i({type:"gotoPage",page:{page:"main"}})}),[i]),O=function(){var e=Object(r.e)();return Object(c.useMemo)((function(){return e.filter((function(e){return"RunView"===e.type})).map((function(e){return e}))}),[e])}();return o?Object(b.jsxs)("div",{children:[Object(b.jsx)(le,{onClick:p,children:"Back"}),d?Object(b.jsx)("span",{children:O.map((function(e){return Object(b.jsx)(e.component,{run:o,iterations:f},e.name)}))}):Object(b.jsx)("div",{children:"Loading..."})]}):Object(b.jsxs)("div",{children:["Run not found: ",n]})},fe=function(e){var t=e.workspace,n=e.workspaceRoute,r=e.workspaceDispatch,c=e.workspaceRouteDispatch;if("main"===n.page)return Object(b.jsx)(be,{workspace:t,workspaceDispatch:r,workspaceRouteDispatch:c});if("run"===n.page)return Object(b.jsx)(de,{workspace:t,runId:n.runId,workspaceRouteDispatch:c});throw Error("Invalid page")};var pe=function(e){!function(e){e.registerPlugin({type:"MainWindow",name:"MainWindow",label:"Main Window",component:ue})}(e),function(e){e.registerPlugin({type:"WorkspaceView",name:"WorkspaceView",label:"Workspace View",component:fe})}(e),function(e){e.registerPlugin({type:"RunView",name:"ChainsTable",label:"Chains Table",component:S})}(e),function(e){e.registerPlugin({type:"RunView",name:"IterationsTable",label:"Iterations Table",component:q})}(e),function(e){e.registerPlugin({type:"RunView",name:"IterationsPlot",label:"Iterations Plot",component:L})}(e)},Oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,209)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),i(e),o(e)}))},he=Object(r.d)();pe(he);var me={webSocketUrl:"ws://".concat(window.location.hostname,":").concat(f.webSocketPort),baseSha1Url:"http://".concat(window.location.hostname,":").concat(f.httpPort,"/sha1"),baseFeedUrl:"http://".concat(window.location.hostname,":").concat(f.httpPort,"/feed")};o.a.render(Object(b.jsx)(r.b,{extensionContext:he,apiConfig:me,children:Object(b.jsx)(a.a,{children:Object(b.jsx)(d,{})})}),document.getElementById("root")),Oe()},64:function(e){e.exports=JSON.parse('{"webSocketPort":10408,"httpPort":10409}')}},[[166,1,2]]]);
//# sourceMappingURL=main.c8ddce65.chunk.js.map