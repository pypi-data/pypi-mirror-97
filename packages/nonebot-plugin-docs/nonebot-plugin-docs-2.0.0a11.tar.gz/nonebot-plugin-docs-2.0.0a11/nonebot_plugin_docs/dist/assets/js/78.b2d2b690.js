(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{531:function(t,s,e){"use strict";e.r(s);var _=e(21),a=Object(_.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"nonebot-rule-模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nonebot-rule-模块"}},[t._v("#")]),t._v(" NoneBot.rule 模块")]),t._v(" "),e("h2",{attrs:{id:"规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#规则"}},[t._v("#")]),t._v(" 规则")]),t._v(" "),e("p",[t._v("每个事件响应器 "),e("code",[t._v("Matcher")]),t._v(" 拥有一个匹配规则 "),e("code",[t._v("Rule")]),t._v(" ，其中是 "),e("strong",[t._v("异步")]),t._v(" "),e("code",[t._v("RuleChecker")]),t._v(" 的集合，只有当所有 "),e("code",[t._v("RuleChecker")]),t._v(" 检查结果为 "),e("code",[t._v("True")]),t._v(" 时继续运行。")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[e("code",[t._v("RuleChecker")]),t._v(" 既可以是 async function 也可以是 sync function，但在最终会被 "),e("code",[t._v("nonebot.utils.run_sync")]),t._v(" 转换为 async function")])]),t._v(" "),e("h2",{attrs:{id:"class-rule"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#class-rule"}},[t._v("#")]),t._v(" "),e("em",[t._v("class")]),t._v(" "),e("code",[t._v("Rule")])]),t._v(" "),e("p",[t._v("基类："),e("code",[t._v("object")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[e("code",[t._v("Matcher")]),t._v(" 规则类，当事件传递时，在 "),e("code",[t._v("Matcher")]),t._v(" 运行前进行检查。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("示例")])])])]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("Rule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("async_function"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" sync_function\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 等价于")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" run_sync\nRule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("async_function"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" run_sync"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sync_function"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("h3",{attrs:{id:"init-checkers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#init-checkers"}},[t._v("#")]),t._v(" "),e("code",[t._v("__init__(*checkers)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("*checkers: Callable[[Bot, Event, T_State], Awaitable[bool]]")]),t._v(": "),e("strong",[t._v("异步")]),t._v(" RuleChecker")])])])]),t._v(" "),e("h3",{attrs:{id:"checkers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#checkers"}},[t._v("#")]),t._v(" "),e("code",[t._v("checkers")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("存储 "),e("code",[t._v("RuleChecker")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("类型")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Set[Callable[[Bot, Event, T_State], Awaitable[bool]]]")])])])])]),t._v(" "),e("h3",{attrs:{id:"async-call-bot-event-state"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#async-call-bot-event-state"}},[t._v("#")]),t._v(" "),e("em",[t._v("async")]),t._v(" "),e("code",[t._v("__call__(bot, event, state)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("检查是否符合所有规则")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("bot: Bot")]),t._v(": Bot 对象")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("event: Event")]),t._v(": Event 对象")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("state: T_State")]),t._v(": 当前 State")])])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("返回")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("bool")])])])])]),t._v(" "),e("h2",{attrs:{id:"startswith-msg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#startswith-msg"}},[t._v("#")]),t._v(" "),e("code",[t._v("startswith(msg)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("匹配消息开头")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("msg: str")]),t._v(": 消息开头字符串")])])])]),t._v(" "),e("h2",{attrs:{id:"endswith-msg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#endswith-msg"}},[t._v("#")]),t._v(" "),e("code",[t._v("endswith(msg)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("匹配消息结尾")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("msg: str")]),t._v(": 消息结尾字符串")])])])]),t._v(" "),e("h2",{attrs:{id:"keyword-keywords"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keyword-keywords"}},[t._v("#")]),t._v(" "),e("code",[t._v("keyword(*keywords)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("匹配消息关键词")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("*keywords: str")]),t._v(": 关键词")])])])]),t._v(" "),e("h2",{attrs:{id:"command-cmds"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#command-cmds"}},[t._v("#")]),t._v(" "),e("code",[t._v("command(*cmds)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("命令形式匹配，根据配置里提供的 "),e("code",[t._v("command_start")]),t._v(", "),e("code",[t._v("command_sep")]),t._v(" 判断消息是否为命令。")]),t._v(" "),e("p",[t._v("可以通过 "),e("code",[t._v('state["_prefix"]["command"]')]),t._v(" 获取匹配成功的命令（例："),e("code",[t._v('("test",)')]),t._v("），通过 "),e("code",[t._v('state["_prefix"]["raw_command"]')]),t._v(" 获取匹配成功的原始命令文本（例："),e("code",[t._v('"/test"')]),t._v("）。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("*cmds: Union[str, Tuple[str, ...]]")]),t._v(": 命令内容")])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("示例")])]),t._v(" "),e("p",[t._v("使用默认 "),e("code",[t._v("command_start")]),t._v(", "),e("code",[t._v("command_sep")]),t._v(" 配置")]),t._v(" "),e("p",[t._v("命令 "),e("code",[t._v('("test",)')]),t._v(" 可以匹配："),e("code",[t._v("/test")]),t._v(" 开头的消息\n命令 "),e("code",[t._v('("test", "sub")')]),t._v(" 可以匹配”"),e("code",[t._v("/test.sub")]),t._v(" 开头的消息")])])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("命令内容与后续消息间无需空格！")])]),t._v(" "),e("h2",{attrs:{id:"class-argumentparser"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#class-argumentparser"}},[t._v("#")]),t._v(" "),e("em",[t._v("class")]),t._v(" "),e("code",[t._v("ArgumentParser")])]),t._v(" "),e("p",[t._v("基类："),e("code",[t._v("argparse.ArgumentParser")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[e("code",[t._v("shell_like")]),t._v(" 命令参数解析器，解析出错时不会退出程序。")])])]),t._v(" "),e("h2",{attrs:{id:"shell-command-cmds-parser-none"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#shell-command-cmds-parser-none"}},[t._v("#")]),t._v(" "),e("code",[t._v("shell_command(*cmds, parser=None)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("支持 "),e("code",[t._v("shell_like")]),t._v(" 解析参数的命令形式匹配，根据配置里提供的 "),e("code",[t._v("command_start")]),t._v(", "),e("code",[t._v("command_sep")]),t._v(" 判断消息是否为命令。")]),t._v(" "),e("p",[t._v("可以通过 "),e("code",[t._v('state["_prefix"]["command"]')]),t._v(" 获取匹配成功的命令（例："),e("code",[t._v('("test",)')]),t._v("），通过 "),e("code",[t._v('state["_prefix"]["raw_command"]')]),t._v(" 获取匹配成功的原始命令文本（例："),e("code",[t._v('"/test"')]),t._v("）。")]),t._v(" "),e("p",[t._v("可以通过 "),e("code",[t._v('state["argv"]')]),t._v(" 获取用户输入的原始参数列表")]),t._v(" "),e("p",[t._v("添加 "),e("code",[t._v("parser")]),t._v(" 参数后, 可以自动处理消息并将结果保存在 "),e("code",[t._v('state["args"]')]),t._v(" 中。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("*cmds: Union[str, Tuple[str, ...]]")]),t._v(": 命令内容")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("parser: Optional[ArgumentParser]")]),t._v(": "),e("code",[t._v("nonebot.rule.ArgumentParser")]),t._v(" 对象")])])])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("示例")])]),t._v(" "),e("p",[t._v("使用默认 "),e("code",[t._v("command_start")]),t._v(", "),e("code",[t._v("command_sep")]),t._v(" 配置，更多示例参考 "),e("code",[t._v("argparse")]),t._v(" 标准库文档。")])])]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rule "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ArgumentParser\n\nparser "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ArgumentParser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nparser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-a"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"store_true"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrule "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shell_command"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ls"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" parser"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("parser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("命令内容与后续消息间无需空格！")])]),t._v(" "),e("h2",{attrs:{id:"regex-regex-flags-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#regex-regex-flags-0"}},[t._v("#")]),t._v(" "),e("code",[t._v("regex(regex, flags=0)")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("根据正则表达式进行匹配。")]),t._v(" "),e("p",[t._v("可以通过 "),e("code",[t._v('state["_matched"]')]),t._v(" "),e("code",[t._v('state["_matched_groups"]')]),t._v(" "),e("code",[t._v('state["_matched_dict"]')]),t._v("\n获取正则表达式匹配成功的文本。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("regex: str")]),t._v(": 正则表达式")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("flags: Union[int, re.RegexFlag]")]),t._v(": 正则标志")])])])])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("正则表达式匹配使用 search 而非 match，如需从头匹配请使用 "),e("code",[t._v('r"^xxx"')]),t._v(" 来确保匹配开头")])]),t._v(" "),e("h2",{attrs:{id:"to-me"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#to-me"}},[t._v("#")]),t._v(" "),e("code",[t._v("to_me()")])]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[t._v("通过 "),e("code",[t._v("event.is_tome()")]),t._v(" 判断事件是否与机器人有关")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("参数")])]),t._v(" "),e("ul",[e("li",[t._v("无")])])])])])}),[],!1,null,null,null);s.default=a.exports}}]);