(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{545:function(t,s,n){"use strict";n.r(s);var a=n(21),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"加载插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加载插件"}},[t._v("#")]),t._v(" 加载插件")]),t._v(" "),n("p",[t._v("在 "),n("a",{attrs:{href:"creating-a-project"}},[t._v("创建一个完整的项目")]),t._v(" 一章节中，我们已经创建了插件目录 "),n("code",[t._v("awesome_bot/plugins")]),t._v("，现在我们在机器人入口文件中加载它。当然，你也可以单独加载一个插件。")]),t._v(" "),n("h2",{attrs:{id:"加载内置插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加载内置插件"}},[t._v("#")]),t._v(" 加载内置插件")]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("bot.py")]),t._v(" 文件中添加以下行：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" nonebot\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adapters"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cqhttp "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Bot\n\nnonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndriver "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndriver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register_adapter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cqhttp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Bot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册 CQHTTP 的 Adapter")]),t._v("\nnonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_builtin_plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载 nonebot 内置插件")]),t._v("\n\napp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_asgi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("p",[t._v("目前, 内建插件仅支持 CQHTTP 的 Adapter")]),t._v(" "),n("p",[t._v("如果您使用的是其他 Adapter, 请移步该 Adapter 相应的文档")])]),t._v(" "),n("p",[t._v("这将会加载 nonebot 内置的插件，它包含：")]),t._v(" "),n("ul",[n("li",[t._v("命令 "),n("code",[t._v("say")]),t._v("：可由"),n("strong",[t._v("superuser")]),t._v("使用，可以将消息内容由特殊纯文本转为富文本")]),t._v(" "),n("li",[t._v("命令 "),n("code",[t._v("echo")]),t._v("：可由任何人使用，将消息原样返回")])]),t._v(" "),n("p",[t._v("以上命令均需要指定机器人，即私聊、群聊内@机器人、群聊内称呼机器人昵称。参考 "),n("router-link",{attrs:{to:"./../api/rule.html#to-me"}},[t._v("Rule: to_me")])],1),t._v(" "),n("h2",{attrs:{id:"加载插件目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加载插件目录"}},[t._v("#")]),t._v(" 加载插件目录")]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("bot.py")]),t._v(" 文件中添加以下行：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" nonebot\n\nnonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载插件目录，该目录下为各插件，以下划线开头的插件将不会被加载")]),t._v("\nnonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"awesome_bot/plugins"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_asgi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("加载插件目录时，目录下以 "),n("code",[t._v("_")]),t._v(" 下划线开头的插件将不会被加载！")])]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[n("strong",[t._v("不能存在相同名称的插件！")])])]),t._v(" "),n("div",{staticClass:"custom-block danger"},[n("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),n("p",[t._v("插件间不应该存在过多的耦合，如果确实需要导入某个插件内的数据，可以参考 "),n("router-link",{attrs:{to:"./../advanced/export-and-require.html"}},[t._v("进阶-跨插件访问")])],1)]),t._v(" "),n("h2",{attrs:{id:"加载单个插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加载单个插件"}},[t._v("#")]),t._v(" 加载单个插件")]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("bot.py")]),t._v(" 文件中添加以下行：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" nonebot\n\nnonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载一个 pip 安装的插件")]),t._v("\nnonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_plugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nonebot_plugin_status"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载本地的单独插件")]),t._v("\nnonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_plugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"awesome_bot.plugins.xxx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_asgi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("h2",{attrs:{id:"子插件-嵌套插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#子插件-嵌套插件"}},[t._v("#")]),t._v(" 子插件(嵌套插件)")]),t._v(" "),n("p",[t._v("在插件中同样可以加载子插件，例如如下插件目录结构：")]),t._v(" "),n("pre",{staticClass:"vue-container"},[n("code",[n("p",[t._v("foo_plugin\n├── "),n("code",[t._v("plugins")]),t._v("\n│   ├── "),n("code",[t._v("sub_plugin1")]),t._v("\n│   │  └── __init__.py\n│   └── "),n("code",[t._v("sub_plugin2.py")]),t._v("\n├── "),n("code",[t._v("__init__.py")]),t._v("\n└── config.py")]),t._v("\n")])]),t._v(" "),n("p",[t._v("在插件目录下的 "),n("code",[t._v("__init__.py")]),t._v(" 中添加如下代码：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pathlib "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Path\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" nonebot\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# store all subplugins")]),t._v("\n_sub_plugins "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# load sub plugins")]),t._v("\n_sub_plugins "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nonebot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__file__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugins"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resolve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("p",[t._v("插件将会被加载并存储于 "),n("code",[t._v("_sub_plugins")]),t._v(" 中。")]),t._v(" "),n("h2",{attrs:{id:"运行结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行结果"}},[t._v("#")]),t._v(" 运行结果")]),t._v(" "),n("p",[t._v("尝试运行 "),n("code",[t._v("nb run")]),t._v(" 或者 "),n("code",[t._v("python bot.py")]),t._v("，可以看到日志输出了类似如下内容：")]),t._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('09-19 21:51:59 [INFO] nonebot | Succeeded to import "nonebot.plugins.base"\n09-19 21:51:59 [INFO] nonebot | Succeeded to import "plugin_in_folder"\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);