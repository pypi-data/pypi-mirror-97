(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{610:function(t,s,a){"use strict";a.r(s);var n=a(21),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"注册事件响应器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册事件响应器"}},[t._v("#")]),t._v(" 注册事件响应器")]),t._v(" "),a("p",[t._v("好了，现在插件已经创建完毕，我们可以开始编写实际代码了，下面将以一个简易单文件天气查询插件为例。")]),t._v(" "),a("p",[t._v("在插件目录下 "),a("code",[t._v("weather.py")]),t._v(" 中添加如下代码：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" on_command\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rule "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" to_me\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("typing "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" T_State\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adapters "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Event\n\nweather "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" on_command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"天气"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("to_me"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" priority"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@weather"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle_first_receive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" T_State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    args "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 首次发送命令时跟随的参数，例：/天气 上海，则args为上海")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"city"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" args  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果用户发送了参数则直接赋值")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@weather"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("got")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"city"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prompt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"你想查询哪个城市的天气呢？"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle_city")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" T_State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    city "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"city"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" city "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"上海"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"北京"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" weather"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"你想查询的城市暂不支持，请重新输入！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    city_weather "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" get_weather"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" weather"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finish"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("city_weather"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_weather")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('的天气是..."')])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br")])]),a("p",[t._v("为了简单起见，我们在这里的例子中没有接入真实的天气数据，但要接入也非常简单，你可以使用中国天气网、和风天气等网站提供的 API。")]),t._v(" "),a("p",[t._v("接下来我们来说明这段代码是如何工作的。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("从这里开始，你需要对 Python 的 asyncio 编程有所了解，因为 NoneBot 是完全基于 asyncio 的，具体可以参考 "),a("a",{attrs:{href:"https://www.liaoxuefeng.com/wiki/1016959663602400/1017959540289152",target:"_blank",rel:"noopener noreferrer"}},[t._v("廖雪峰的 Python 教程"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"事件响应器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件响应器"}},[t._v("#")]),t._v(" "),a("router-link",{attrs:{to:"./../api/matcher.html"}},[t._v("事件响应器")])],1),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" on_command\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rule "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" to_me\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permission "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Permission\n\nweather "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" on_command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"天气"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("to_me"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" permission"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Permission"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" priority"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("在上方代码中，我们注册了一个事件响应器 "),a("code",[t._v("Matcher")]),t._v("，它由几个部分组成：")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("on_command")]),t._v(" 注册一个消息类型的命令处理器")]),t._v(" "),a("li",[a("code",[t._v('"天气"')]),t._v(" 指定 command 参数 - 命令名")]),t._v(" "),a("li",[a("code",[t._v("rule")]),t._v(" 补充事件响应器的匹配规则")]),t._v(" "),a("li",[a("code",[t._v("priority")]),t._v(" 事件响应器优先级")]),t._v(" "),a("li",[a("code",[t._v("block")]),t._v(" 是否阻止事件传递")])]),t._v(" "),a("p",[t._v("其他详细配置可以参考 API 文档，下面我们详细说明各个部分：")]),t._v(" "),a("h3",{attrs:{id:"事件响应器类型-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件响应器类型-type"}},[t._v("#")]),t._v(" 事件响应器类型 type")]),t._v(" "),a("p",[t._v("事件响应器类型其实就是对应事件的类型 "),a("code",[t._v("Event.get_type()")]),t._v(" ，NoneBot 提供了一个基础类型事件响应器 "),a("code",[t._v("on()")]),t._v(" 以及一些其他内置的事件响应器。")]),t._v(" "),a("p",[t._v("以下所有类型的事件响应器都是由 "),a("code",[t._v("on(type, rule)")]),t._v(" 的形式进行了简化封装。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v('on("事件类型")')]),t._v(": 基础事件响应器，第一个参数为事件类型，空字符串表示不限")]),t._v(" "),a("li",[a("code",[t._v("on_metaevent()")]),t._v(" ~ "),a("code",[t._v('on("meta_event")')]),t._v(": 元事件响应器")]),t._v(" "),a("li",[a("code",[t._v("on_message()")]),t._v(" ~ "),a("code",[t._v('on("message")')]),t._v(": 消息事件响应器")]),t._v(" "),a("li",[a("code",[t._v("on_request()")]),t._v(" ~ "),a("code",[t._v('on("request")')]),t._v(": 请求事件响应器")]),t._v(" "),a("li",[a("code",[t._v("on_notice()")]),t._v(" ~ "),a("code",[t._v('on("notice")')]),t._v(": 通知事件响应器")]),t._v(" "),a("li",[a("code",[t._v("on_startswith(str)")]),t._v(" ~ "),a("code",[t._v('on("message", startswith(str))')]),t._v(": 消息开头匹配响应器，参考 "),a("router-link",{attrs:{to:"./../api/rule.html#startswith-msg"}},[t._v("startswith")])],1),t._v(" "),a("li",[a("code",[t._v("on_endswith(str)")]),t._v(" ~ "),a("code",[t._v('on("message", endswith(str))')]),t._v(": 消息结尾匹配响应器，参考 "),a("router-link",{attrs:{to:"./../api/rule.html#endswith-msg"}},[t._v("endswith")])],1),t._v(" "),a("li",[a("code",[t._v("on_keyword(set)")]),t._v(" ~ "),a("code",[t._v('on("message", keyword(str))')]),t._v(": 消息关键词匹配响应器，参考 "),a("router-link",{attrs:{to:"./../api/rule.html#keyword-keywords"}},[t._v("keyword")])],1),t._v(" "),a("li",[a("code",[t._v("on_command(str|tuple)")]),t._v(" ~ "),a("code",[t._v('on("message", command(str|tuple))')]),t._v(": 命令响应器，参考 "),a("router-link",{attrs:{to:"./../api/rule.html#command-cmds"}},[t._v("command")])],1),t._v(" "),a("li",[a("code",[t._v("on_regex(pattern_str)")]),t._v(" ~ "),a("code",[t._v('on("message", regex(pattern_str))')]),t._v(": 正则匹配处理器，参考 "),a("router-link",{attrs:{to:"./../api/rule.html#regex-regex-flags-0"}},[t._v("regex")])],1)]),t._v(" "),a("h3",{attrs:{id:"匹配规则-rule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配规则-rule"}},[t._v("#")]),t._v(" 匹配规则 rule")]),t._v(" "),a("p",[t._v("事件响应器的匹配规则即 "),a("code",[t._v("Rule")]),t._v("，详细内容在下方介绍。"),a("a",{attrs:{href:"#%E8%87%AA%E5%AE%9A%E4%B9%89-rule"}},[t._v("直达")])]),t._v(" "),a("h3",{attrs:{id:"优先级-priority"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优先级-priority"}},[t._v("#")]),t._v(" 优先级 priority")]),t._v(" "),a("p",[t._v("事件响应器的优先级代表事件响应器的执行顺序，同一优先级的事件响应器会 "),a("strong",[t._v("同时执行！")]),t._v("，优先级数字"),a("strong",[t._v("越小")]),t._v("越先响应！优先级请从 "),a("code",[t._v("1")]),t._v(" 开始排序！")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("nonebot-plugin-test")]),t._v(" 可以在网页端查看当前所有事件响应器的执行流程，有助理解事件响应流程！")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("nb plugin "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nonebot_plugin_test\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("h3",{attrs:{id:"阻断-block"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阻断-block"}},[t._v("#")]),t._v(" 阻断 block")]),t._v(" "),a("p",[t._v("当有任意事件响应器发出了阻止事件传递信号时，该事件将不再会传递给下一优先级，直接结束处理。")]),t._v(" "),a("p",[t._v("NoneBot 内置的事件响应器中，所有 "),a("code",[t._v("message")]),t._v(" 类的事件响应器默认会阻断事件传递，其他则不会。")]),t._v(" "),a("h2",{attrs:{id:"自定义-rule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义-rule"}},[t._v("#")]),t._v(" 自定义 rule")]),t._v(" "),a("p",[t._v("rule 的出现使得 nonebot 对事件的响应可以非常自由，nonebot 内置了一些规则：")]),t._v(" "),a("ul",[a("li",[a("router-link",{attrs:{to:"./../api/rule.html#startswith-msg"}},[t._v("startswith(msg)")])],1),t._v(" "),a("li",[a("router-link",{attrs:{to:"./../api/rule.html#endswith-msg"}},[t._v("endswith(msg)")])],1),t._v(" "),a("li",[a("router-link",{attrs:{to:"./../api/rule.html#keyword-keywords"}},[t._v("keyword(*keywords)")])],1),t._v(" "),a("li",[a("router-link",{attrs:{to:"./../api/rule.html#command-cmds"}},[t._v("command(*cmds)")])],1),t._v(" "),a("li",[a("router-link",{attrs:{to:"./../api/rule.html#regex-regex-flags-0"}},[t._v("regex(regex, flag)")])],1)]),t._v(" "),a("p",[t._v("以上规则都是返回类型为 "),a("code",[t._v("Rule")]),t._v(" 的函数，"),a("code",[t._v("Rule")]),t._v(" 由非负个 "),a("code",[t._v("RuleChecker")]),t._v(" 组成，当所有 "),a("code",[t._v("RuleChecker")]),t._v(" 返回 "),a("code",[t._v("True")]),t._v(" 时匹配成功。这些 "),a("code",[t._v("Rule")]),t._v(", "),a("code",[t._v("RuleChecker")]),t._v(" 的形式如下：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rule "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Rule\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("typing "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" T_State\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("async_checker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" T_State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync_checker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" T_State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_checker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" T_State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" arg2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Rule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_checker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[a("code",[t._v("Rule")]),t._v(" 和 "),a("code",[t._v("RuleChecker")]),t._v(" 之间可以使用 "),a("code",[t._v("与 &")]),t._v(" 互相组合：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rule "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Rule\n\nRule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("async_checker1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" sync_checker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" async_checker2\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[a("strong",[a("em",[t._v("请勿将事件处理的逻辑写入 "),a("code",[t._v("rule")]),t._v(" 中，这会使得事件处理返回奇怪的响应。")])])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),a("p",[a("code",[t._v("Rule(*checkers)")]),t._v(" 只接受 async function，或使用 "),a("code",[t._v("nonebot.utils.run_sync")]),t._v(" 自行包裹 sync function。在使用 "),a("code",[t._v("与 &")]),t._v(" 时，NoneBot 会自动包裹 sync function")])])])}),[],!1,null,null,null);s.default=e.exports}}]);