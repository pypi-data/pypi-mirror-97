(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{535:function(s,t,a){"use strict";a.r(t);var n=a(21),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"基本配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本配置"}},[s._v("#")]),s._v(" 基本配置")]),s._v(" "),a("p",[s._v("到目前为止我们还在使用 NoneBot 的默认行为，在开始编写自己的插件之前，我们先尝试在配置文件上动动手脚，让 NoneBot 表现出不同的行为。")]),s._v(" "),a("p",[s._v("在上一章节中，我们创建了默认的项目结构，其中 "),a("code",[s._v(".env")]),s._v(" 和 "),a("code",[s._v(".env.*")]),s._v(" 均为项目的配置文件，下面将介绍几种 NoneBot 配置方式。")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("请勿将敏感信息写入配置文件并提交至开源仓库！")])]),s._v(" "),a("h2",{attrs:{id:"env-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#env-文件"}},[s._v("#")]),s._v(" .env 文件")]),s._v(" "),a("p",[s._v("NoneBot 在启动时将会从系统环境变量或者 "),a("code",[s._v(".env")]),s._v(" 文件中寻找变量 "),a("code",[s._v("ENVIRONMENT")]),s._v(" (大小写不敏感)，默认值为 "),a("code",[s._v("prod")]),s._v("。"),a("br"),s._v("\n这将引导 NoneBot 从系统环境变量或者 "),a("code",[s._v(".env.{ENVIRONMENT}")]),s._v(" 文件中进一步加载具体配置。")]),s._v(" "),a("p",[a("code",[s._v(".env")]),s._v(" 文件是基础环境配置文件，该文件中的配置项在不同环境下都会被加载，但会被 "),a("code",[s._v(".env.{ENVIRONMENT}")]),s._v(" 文件中的配置所覆盖。")]),s._v(" "),a("p",[s._v("现在，我们在 "),a("code",[s._v(".env")]),s._v(" 文件中写入当前环境信息：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .env")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ENVIRONMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dev\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUSTOM_CONFIG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("common config  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个配置项在任何环境中都会被加载")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如你所想，之后 NoneBot 就会从 "),a("code",[s._v(".env.dev")]),s._v(" 文件中加载环境变量。")]),s._v(" "),a("h2",{attrs:{id:"env-文件-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#env-文件-2"}},[s._v("#")]),s._v(" .env.* 文件")]),s._v(" "),a("p",[s._v("NoneBot 使用 "),a("a",{attrs:{href:"https://pydantic-docs.helpmanual.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("pydantic"),a("OutboundLink")],1),s._v(" 进行配置管理，会从 "),a("code",[s._v(".env.{ENVIRONMENT}")]),s._v(" 文件中获悉环境配置。")]),s._v(" "),a("p",[s._v("可以在 NoneBot 初始化时指定加载某个环境配置文件: "),a("code",[s._v('nonebot.init(_env_file=".env.dev")')]),s._v("，这将忽略你在 "),a("code",[s._v(".env")]),s._v(" 中设置的 "),a("code",[s._v("ENVIRONMENT")]),s._v(" 。")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("由于 "),a("code",[s._v("pydantic")]),s._v(" 使用 JSON 解析配置项，请确保配置项值为 JSON 格式的数据。如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("list")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456789"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"987654321"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"world"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果配置项值解析失败将作为字符串处理。")])]),s._v(" "),a("p",[s._v("示例及说明：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 NoneBot 监听的 IP/主机名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 NoneBot 监听的端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEBUG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启 debug 模式 **请勿在生产环境开启**")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SUPERUSERS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456789"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"987654321"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 NoneBot 超级用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NICKNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"awesome"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bot"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置机器人的昵称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("COMMAND_START")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置命令起始字符")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("COMMAND_SEP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置命令分割字符")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Custom Configs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUSTOM_CONFIG1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"config in env file"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUSTOM_CONFIG2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 留空则从系统环境变量读取，如不存在则为空字符串")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("详细的配置项参考 "),a("router-link",{attrs:{to:"./../api/config.html"}},[s._v("Config Reference")]),s._v(" 。")],1),s._v(" "),a("h2",{attrs:{id:"系统环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统环境变量"}},[s._v("#")]),s._v(" 系统环境变量")]),s._v(" "),a("p",[s._v("如果在系统环境变量中定义了配置，则一样会被读取。")]),s._v(" "),a("h2",{attrs:{id:"bot-py-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bot-py-文件"}},[s._v("#")]),s._v(" bot.py 文件")]),s._v(" "),a("p",[s._v("配置项也可以在 NoneBot 初始化时传入。此处可以传入任意合法 Python 变量。当然也可以在初始化完成后修改或新增。")]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bot.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" nonebot\n\nnonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("custom_config3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"config on init"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nconfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config\nconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("custom_config3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"changed after init"')]),s._v("\nconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("custom_config4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new config after init"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"优先级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优先级"}},[s._v("#")]),s._v(" 优先级")]),s._v(" "),a("p",[a("code",[s._v("bot.py")]),s._v(" 文件( "),a("code",[s._v("nonebot.init")]),s._v(" ) > 系统环境变量 > "),a("code",[s._v(".env")]),s._v(" "),a("code",[s._v(".env.*")]),s._v(" 文件")])])}),[],!1,null,null,null);t.default=e.exports}}]);