{
  "actions": [
    {
      "context": [
        {
          "test-type": "mochitest"
        },
        {
          "test-type": "reftest"
        }
      ],
      "description": "Retriggers the specified mochitest/reftest job with additional options",
      "kind": "task",
      "name": "retrigger-mochitest-reftest-with-options",
      "schema": {
        "additionalProperties": false,
        "properties": {
          "environment": {
            "additionalProperties": {
              "type": "string"
            },
            "default": {
              "MOZ_LOG": ""
            },
            "description": "Extra environment variables to use for this run",
            "title": "Extra environment variables",
            "type": "object"
          },
          "logLevel": {
            "default": "debug",
            "description": "Log level for output (default is DEBUG, which is highest)",
            "enum": [
              "debug",
              "info",
              "warning",
              "error",
              "critical"
            ],
            "title": "Log level",
            "type": "string"
          },
          "path": {
            "default": "",
            "description": "Path of test to retrigger",
            "maxLength": 255,
            "title": "Path name",
            "type": "string"
          },
          "preferences": {
            "additionalProperties": {
              "type": "string"
            },
            "default": {
              "mygeckopreferences.pref": "myvalue2"
            },
            "description": "Extra gecko (about:config) preferences to use for this run",
            "title": "Extra gecko (about:config) preferences",
            "type": "object"
          },
          "repeat": {
            "default": 30,
            "description": "Run tests repeatedly (usually used in conjunction with runUntilFail)",
            "minimum": 1,
            "title": "Run tests N times",
            "type": "integer"
          },
          "runUntilFail": {
            "default": true,
            "description": "Runs the specified set of tests repeatedly until failure (or 30 times)",
            "title": "Run until failure",
            "type": "boolean"
          }
        },
        "required": [
          "path"
        ],
        "type": "object"
      },
      "task": {
        "$let": {
          "action": {
            "cb_name": "mochitest_retrigger_action",
            "description": "Retriggers the specified mochitest/reftest job with additional options",
            "name": "retrigger-mochitest-reftest-with-options",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "tr",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Mochitest/Reftest Retrigger"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Mochitest/Reftest Retrigger"
    },
    {
      "context": [
        {}
      ],
      "description": "Take the label of the current task, and trigger the task with that label on previous pushes in the same project.",
      "kind": "task",
      "name": "backfill",
      "schema": {
        "additionalProperties": false,
        "properties": {
          "depth": {
            "default": 5,
            "description": "The number of previous pushes before the current push to attempt to trigger this task on.",
            "maximum": 10,
            "minimum": 1,
            "title": "Depth",
            "type": "integer"
          }
        },
        "type": "object"
      },
      "task": {
        "$let": {
          "action": {
            "cb_name": "backfill_action",
            "description": "Take the label of the current task, and trigger the task with that label on previous pushes in the same project.",
            "name": "backfill",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "Bk",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Backfill"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Backfill"
    },
    {
      "context": [
        {
          "os": "linux",
          "worker-implementation": "docker-worker"
        }
      ],
      "description": "Create a clone of the task for use in interactive tasks.\nThis does not update any dependencies or cause any downstream tasks to be retriggered.\nThe new task will be altered to\n  * Set task.payload.features.interactive = true\n  * Strip task.payload.caches to avoid poisoning\n  * Ensures task.payload.maxRunTime is minimum of 180 minutes\n  * Strip task.routes to avoid side-effects\n  * Set the environment variable TASKCLUSTER_INTERACTIVE=true",
      "kind": "task",
      "name": "docker-worker-linux-loaner",
      "task": {
        "$merge": [
          {
            "$map": {
              "$eval": "task"
            },
            "each(s)": {
              "$if": "!(s.key in [\"routes\", \"dependencies\", \"requires\", \"scopes\", \"payload\"])",
              "then": {
                "${s.key}": {
                  "$eval": "s.val"
                }
              }
            }
          },
          {
            "created": {
              "$fromNow": ""
            }
          },
          {
            "deadline": {
              "$fromNow": "12 hours"
            }
          },
          {
            "expires": {
              "$fromNow": "7 days"
            }
          },
          {
            "scopes": {
              "$map": {
                "$eval": "task.scopes"
              },
              "each(scope)": {
                "$if": "scope[:7] != \"docker-worker:cache:\"",
                "then": "${scope}"
              }
            }
          },
          {
            "payload": {
              "$merge": [
                {
                  "$map": {
                    "$eval": "task.payload"
                  },
                  "each(s)": {
                    "$if": "!(s.key in [\"artifacts\", \"cache\"])",
                    "then": {
                      "${s.key}": {
                        "$eval": "s.val"
                      }
                    }
                  }
                },
                {
                  "env": {
                    "$merge": [
                      {
                        "$if": "\"env\" in task.payload",
                        "then": {
                          "$eval": "task.payload.env"
                        }
                      },
                      {
                        "TASKCLUSTER_INTERACTIVE": true
                      }
                    ]
                  },
                  "features": {
                    "$merge": [
                      {
                        "$if": "\"features\" in task.payload",
                        "then": {
                          "$eval": "task.payload.features"
                        }
                      },
                      {
                        "interactive": true
                      }
                    ]
                  },
                  "maxRunTime": {
                    "$eval": "max(task.payload.maxRunTime, 3 * 60 * 60)"
                  }
                }
              ]
            }
          }
        ]
      },
      "title": "Create Loaner (Docker Worker Linux)"
    },
    {
      "context": [
        {}
      ],
      "description": "Create a clone of the task.",
      "kind": "task",
      "name": "retrigger",
      "schema": {
        "properties": {
          "downstream": {
            "default": false,
            "description": "If true, downstream tasks from this one will be cloned as well. The dependencies will be updated to work with the new task at the root.",
            "type": "boolean"
          },
          "times": {
            "default": 1,
            "description": "How many times to run each task.",
            "maximum": 6,
            "minimum": 1,
            "title": "Times",
            "type": "integer"
          }
        },
        "type": "object"
      },
      "task": {
        "$let": {
          "action": {
            "cb_name": "retrigger_action",
            "description": "Create a clone of the task.\n\n",
            "name": "retrigger",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "rt",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Retrigger"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Retrigger"
    },
    {
      "context": [
        {
          "worker-implementation": "docker-worker"
        }
      ],
      "description": "Purge any caches associated with this task across all workers of the same workertype as the task.",
      "kind": "task",
      "name": "purge-caches",
      "task": {
        "$let": {
          "action": {
            "cb_name": "purge_caches_action",
            "description": "Purge any caches associated with this task across all workers of the same workertype as the task.",
            "name": "purge-caches",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "purge-caches",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Purge Caches"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Purge Caches"
    },
    {
      "context": [],
      "description": "Add all Talos tasks to a push.",
      "kind": "task",
      "name": "run-all-talos",
      "schema": {
        "additionalProperties": false,
        "properties": {
          "times": {
            "default": 1,
            "description": "How many times to run each task.",
            "maximum": 6,
            "minimum": 1,
            "title": "Times",
            "type": "integer"
          }
        },
        "type": "object"
      },
      "task": {
        "$let": {
          "action": {
            "cb_name": "add_all_talos",
            "description": "Add all Talos tasks to a push.",
            "name": "run-all-talos",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "raT",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Run All Talos Tests"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Run All Talos Tests"
    },
    {
      "context": [],
      "description": "Run tests in the selected push that were optimized away, usually by SETA.\nThis action is for use on pushes that will be merged into another branch,to check that optimization hasn't hidden any failures.",
      "kind": "task",
      "name": "run-missing-tests",
      "task": {
        "$let": {
          "action": {
            "cb_name": "run_missing_tests",
            "description": "Run tests in the selected push that were optimized away, usually by SETA.\nThis action is for use on pushes that will be merged into another branch,to check that optimization hasn't hidden any failures.",
            "name": "run-missing-tests",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "rmt",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Run Missing Tests"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Run Missing Tests"
    },
    {
      "context": [],
      "description": "Cancel all running and pending tasks created by the decision task this action task is associated with.",
      "kind": "task",
      "name": "cancel-all",
      "task": {
        "$let": {
          "action": {
            "cb_name": "cancel_all_action",
            "description": "Cancel all running and pending tasks created by the decision task this action task is associated with.",
            "name": "cancel-all",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "cAll",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Cancel All"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Cancel All"
    },
    {
      "context": [],
      "description": "Promote a release.",
      "kind": "task",
      "name": "release-promotion",
      "hookPayload": {
        "decision": {
          "action": {
            "cb_name": "release_promotion_action"
          }
        }
      },
      "schema": {
        "properties": {
          "build_number": {
            "default": 1,
            "description": "The release build number. Starts at 1 per release version, and increments on rebuild.",
            "minimum": 1,
            "title": "The release build number",
            "type": "integer"
          },
          "desktop_release_type": {
            "default": "",
            "type": "string"
          },
          "do_not_optimize": {
            "description": "Optional: a list of labels to avoid optimizing out of the graph (to force a rerun of, say, funsize docker-image tasks).",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "next_version": {
            "default": "",
            "description": "Next version.",
            "type": "string"
          },
          "partial_updates": {
            "additionalProperties": {
              "additionalProperties": false,
              "properties": {
                "buildNumber": {
                  "type": "number"
                },
                "locales": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                }
              },
              "required": [
                "buildNumber",
                "locales"
              ],
              "type": "object"
            },
            "default": {},
            "description": "Partial updates.",
            "type": "object"
          },
          "previous_graph_ids": {
            "description": "Optional: an array of taskIds of decision or action tasks from the previous graph(s) to use to populate our `previous_graph_kinds`.",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "rebuild_kinds": {
            "description": "Optional: an array of kinds to ignore from the previous graph(s).",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "release_promotion_flavor": {
            "description": "The flavor of release promotion to perform.",
            "enum": [
              "promote_devedition",
              "promote_fennec",
              "promote_firefox",
              "push_devedition",
              "push_firefox",
              "ship_devedition",
              "ship_fennec",
              "ship_firefox"
            ],
            "type": "string"
          },
          "revision": {
            "description": "Optional: the revision to promote. If specified, and if neither `pushlog_id` nor `previous_graph_kinds` is specified, find the `pushlog_id using the revision.",
            "title": "Optional: revision to promote",
            "type": "string"
          },
          "target_tasks_method": {
            "description": "Optional: the target task method to use to generate the new graph.",
            "title": "target task method",
            "type": "string"
          },
          "uptake_monitoring_platforms": {
            "default": [],
            "items": {
              "enum": [
                "macosx",
                "win32",
                "win64",
                "linux",
                "linux64"
              ],
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "release_promotion_flavor",
          "build_number"
        ],
        "type": "object"
      },
      "task": {
        "$let": {
          "action": {
            "cb_name": "release_promotion_action",
            "description": "Promote a release.",
            "name": "release-promotion",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "Relpro",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Release Promotion"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Release Promotion"
    },
    {
      "context": [],
      "description": "Add new jobs using task labels.",
      "kind": "task",
      "name": "add-new-jobs",
      "schema": {
        "properties": {
          "tasks": {
            "description": "An array of task labels",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "type": "object"
      },
      "task": {
        "$let": {
          "action": {
            "cb_name": "add_new_jobs_action",
            "description": "Add new jobs using task labels.",
            "name": "add-new-jobs",
            "repo_scope": "assume:repo:hg.mozilla.org/projects/maple:*",
            "symbol": "add-new",
            "taskGroupId": "VQU9QMO4Teq7zr91FhBusg",
            "title": "Add new jobs"
          },
          "push": {
            "owner": "mozilla-taskcluster-maintenance@mozilla.com",
            "pushlog_id": "343",
            "revision": "054fe08d229f064a71bae9bb793e7ab8d95eff61"
          },
          "repository": {
            "level": "3",
            "project": "maple",
            "url": "https://hg.mozilla.org/projects/maple"
          },
          "tasks_for": "action"
        },
        "in": {
          "$let": {
            "ownerEmail": {
              "$if": "\"@\" in push.owner",
              "else": "${push.owner}@noreply.mozilla.org",
              "then": "${push.owner}"
            },
            "repoUrl": {
              "$if": "repository.url[-1] == \"/\"",
              "else": {
                "$eval": "repository.url"
              },
              "then": {
                "$eval": "repository.url[:-1]"
              }
            }
          },
          "in": {
            "created": {
              "$fromNow": ""
            },
            "deadline": {
              "$fromNow": "1 day"
            },
            "dependencies": [],
            "expires": {
              "$fromNow": "1 year 1 second"
            },
            "extra": {
              "$merge": [
                {
                  "treeherder": {
                    "$merge": [
                      {
                        "machine": {
                          "platform": "gecko-decision"
                        }
                      },
                      {
                        "$if": "tasks_for == \"hg-push\"",
                        "else": {
                          "$if": "tasks_for == \"action\"",
                          "else": {
                            "groupSymbol": "cron",
                            "symbol": "${cron.job_symbol}"
                          },
                          "then": {
                            "groupName": "action-callback",
                            "groupSymbol": "AC",
                            "symbol": "${action.symbol}"
                          }
                        },
                        "then": {
                          "symbol": "D"
                        }
                      }
                    ]
                  }
                },
                {
                  "$if": "tasks_for == \"action\"",
                  "then": {
                    "action": {
                      "context": {
                        "input": {
                          "$eval": "input"
                        },
                        "parameters": {
                          "$eval": "parameters"
                        },
                        "taskGroupId": "${action.taskGroupId}",
                        "taskId": {
                          "$eval": "taskId"
                        }
                      },
                      "name": "${action.name}"
                    },
                    "parent": "${action.taskGroupId}"
                  }
                },
                {
                  "$if": "tasks_for == \"cron\"",
                  "then": {
                    "cron": {
                      "$json": {
                        "$eval": "cron"
                      }
                    }
                  }
                },
                {
                  "tasks_for": "${tasks_for}"
                }
              ]
            },
            "metadata": {
              "$merge": [
                {
                  "owner": "${ownerEmail}",
                  "source": "${repoUrl}/raw-file/${push.revision}/.taskcluster.yml"
                },
                {
                  "$if": "tasks_for == \"hg-push\"",
                  "else": {
                    "$if": "tasks_for == \"action\"",
                    "else": {
                      "description": "Created by a [cron task](https://tools.taskcluster.net/tasks/${cron.task_id})",
                      "name": "Decision Task for cron job ${cron.job_name}"
                    },
                    "then": {
                      "description": "${action.description}",
                      "name": "Action: ${action.title}"
                    }
                  },
                  "then": {
                    "description": "The task that creates all of the other tasks in the task graph",
                    "name": "Gecko Decision Task"
                  }
                }
              ]
            },
            "payload": {
              "artifacts": {
                "public": {
                  "expires": {
                    "$fromNow": "1 year"
                  },
                  "path": "/builds/worker/artifacts",
                  "type": "directory"
                }
              },
              "cache": {
                "level-${repository.level}-checkouts-sparse-v1": "/builds/worker/checkouts"
              },
              "command": [
                "/builds/worker/bin/run-task",
                "--vcs-checkout=/builds/worker/checkouts/gecko",
                "--sparse-profile=build/sparse-profiles/taskgraph",
                "--",
                "bash",
                "-cx",
                {
                  "$let": {
                    "extraArgs": {
                      "$if": "tasks_for == \"cron\"",
                      "else": "",
                      "then": "${cron.quoted_args}"
                    }
                  },
                  "in": {
                    "$if": "tasks_for == \"action\"",
                    "else": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph decision --pushlog-id='${push.pushlog_id}' --pushdate='${push.pushdate}' --project='${repository.project}' --message=\"$GECKO_COMMIT_MSG\" --owner='${ownerEmail}' --level='${repository.level}' --base-repository=\"$GECKO_BASE_REPOSITORY\" --head-repository=\"$GECKO_HEAD_REPOSITORY\" --head-ref=\"$GECKO_HEAD_REF\" --head-rev=\"$GECKO_HEAD_REV\" ${extraArgs}\n",
                    "then": "cd /builds/worker/checkouts/gecko && ln -s /builds/worker/artifacts artifacts && ./mach --log-no-times taskgraph action-callback\n"
                  }
                }
              ],
              "env": {
                "$merge": [
                  {
                    "GECKO_BASE_REPOSITORY": "https://hg.mozilla.org/mozilla-unified",
                    "GECKO_COMMIT_MSG": {
                      "$if": "tasks_for != \"action\"",
                      "then": "${push.comment}"
                    },
                    "GECKO_HEAD_REF": "${push.revision}",
                    "GECKO_HEAD_REPOSITORY": "${repoUrl}",
                    "GECKO_HEAD_REV": "${push.revision}",
                    "HG_STORE_PATH": "/builds/worker/checkouts/hg-store",
                    "TASKCLUSTER_CACHES": "/builds/worker/checkouts"
                  },
                  {
                    "$if": "tasks_for == \"action\"",
                    "then": {
                      "ACTION_CALLBACK": "${action.cb_name}",
                      "ACTION_INPUT": {
                        "$json": {
                          "$eval": "input"
                        }
                      },
                      "ACTION_PARAMETERS": {
                        "$json": {
                          "$eval": "parameters"
                        }
                      },
                      "ACTION_TASK": {
                        "$json": {
                          "$eval": "task"
                        }
                      },
                      "ACTION_TASK_GROUP_ID": "${ownTaskId}",
                      "ACTION_TASK_ID": {
                        "$json": {
                          "$eval": "taskId"
                        }
                      }
                    }
                  }
                ]
              },
              "features": {
                "chainOfTrust": true,
                "taskclusterProxy": true
              },
              "image": "taskcluster/decision:2.0.0@sha256:4039fd878e5700b326d4a636e28c595c053fbcb53909c1db84ad1f513cf644ef",
              "maxRunTime": 1800
            },
            "priority": "lowest",
            "provisionerId": "aws-provisioner-v1",
            "requires": "all-completed",
            "retries": 5,
            "routes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": [
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                {
                  "$if": "tasks_for == \"action\"",
                  "else": "index.gecko.v2.${repository.project}.latest.firefox.decision-${cron.job_name}",
                  "then": "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.actions.${ownTaskId}"
                }
              ],
              "then": [
                "index.gecko.v2.${repository.project}.latest.firefox.decision",
                "index.gecko.v2.${repository.project}.revision.${push.revision}.firefox.decision",
                "index.gecko.v2.${repository.project}.pushlog-id.${push.pushlog_id}.decision",
                "tc-treeherder.v2.${repository.project}.${push.revision}.${push.pushlog_id}",
                "notify.email.${ownerEmail}.on-failed",
                "notify.email.${ownerEmail}.on-exception"
              ]
            },
            "schedulerId": "gecko-level-${repository.level}",
            "scopes": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "else": [
                  "assume:repo:${repoUrl[8:]}:cron:${cron.job_name}"
                ],
                "then": [
                  "${action.repo_scope}"
                ]
              },
              "then": [
                "assume:repo:${repoUrl[8:]}:*",
                "queue:route:notify.email.${ownerEmail}.*"
              ]
            },
            "tags": {
              "$if": "tasks_for == \"hg-push\"",
              "else": {
                "$if": "tasks_for == \"action\"",
                "then": {
                  "createdForUser": "${ownerEmail}",
                  "kind": "action-callback"
                }
              },
              "then": {
                "createdForUser": "${ownerEmail}"
              }
            },
            "taskGroupId": {
              "$if": "tasks_for == \"action\"",
              "else": "${as_slugid(\"decision\")}",
              "then": "${action.taskGroupId}"
            },
            "taskId": {
              "$if": "tasks_for != \"action\"",
              "then": "${as_slugid(\"decision\")}"
            },
            "workerType": "gecko-${repository.level}-decision"
          }
        }
      },
      "title": "Add new jobs"
    }
  ],
  "variables": {
    "parameters": {
      "base_repository": "https://hg.mozilla.org/mozilla-unified",
      "build_date": 1515524845,
      "build_number": 1,
      "desktop_release_type": "",
      "do_not_optimize": [],
      "existing_tasks": {},
      "filters": [
        "check_servo",
        "target_tasks_method"
      ],
      "head_ref": "054fe08d229f064a71bae9bb793e7ab8d95eff61",
      "head_repository": "https://hg.mozilla.org/projects/maple",
      "head_rev": "054fe08d229f064a71bae9bb793e7ab8d95eff61",
      "include_nightly": true,
      "level": "3",
      "message": " ",
      "moz_build_date": "20180109190725",
      "next_version": null,
      "optimize_target_tasks": true,
      "owner": "asasaki@mozilla.com",
      "project": "maple",
      "pushdate": 1515524845,
      "pushlog_id": "343",
      "release_history": {},
      "target_tasks_method": "mozilla_beta_tasks",
      "try_mode": null,
      "try_options": null,
      "try_task_config": null
    }
  },
  "version": 1
}
