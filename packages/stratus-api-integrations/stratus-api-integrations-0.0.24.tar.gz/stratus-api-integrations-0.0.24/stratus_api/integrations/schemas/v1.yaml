openapi: 3.0.0
info:
  title: Example API
  version: 1.0.0
servers:
  - url: /integrations/v1/
paths:
  /destinations:
    post:
      operationId: stratus_api.integrations.routes.v1.destinations.create_destination_request
      security:
        - oauth2:
            - post:destinations
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - destination_uuid
                - platform_name
                - name
                - settings
              properties:
                destination_uuid:
                  type: string
                account_uuid:
                  type: string
                product_uuid:
                  type: string
                platform_name:
                  type: string
                name:
                  type: string
                settings:
                  type: object
      responses:
        200:
          description: returns what you send
          content:
            application/json:
              schema:
                type: object
                properties:
                  active:
                    type: boolean
                  response:
                    type: object
                    properties:
                      external_id:
                        type: string
                      external_attributes:
                        type: object
        400:
          $ref: '#/components/responses/BadRequest'
  /destinations/{platform_name}/template:
    get:
      operationId: stratus_api.integrations.routes.v1.destinations.get_destination_template_request
      security:
        - oauth2:
            - get:destinations/template
      parameters:
        - in: path
          name: platform_name
          required: true
          schema:
            type: string
      responses:
        200:
          description: returns what you send
          content:
            application/json:
              schema:
                type: object
                properties:
                  active:
                    type: boolean
                  response:
                    type: object
  /segments:
    post:
      operationId: stratus_api.integrations.routes.v1.segments.create_segment_request
      security:
        - oauth2:
            - post:segments
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - segment_uuid
                - platform_name
                - name
                - destination
                - settings
              properties:
                segment_uuid:
                  type: string
                platform_name:
                  type: string
                name:
                  type: string
                destination:
                  $ref: '#/components/schemas/Destination'
                settings:
                  type: object
      responses:
        200:
          description: returns what you send
          content:
            application/json:
              schema:
                type: object
                required:
                  - active
                  - response
                properties:
                  active:
                    type: boolean
                  response:
                    type: object
                    required:
                      - external_id
                      - external_attributes
                    properties:
                      external_id:
                        type: string
                      external_attributes:
                        type: object
        400:
          $ref: '#/components/responses/BadRequest'
  /segments/{platform_name}/template:
    get:
      operationId: stratus_api.integrations.routes.v1.segments.get_segment_template_request
      security:
        - oauth2:
            - get:segments/template
      parameters:
        - in: path
          required: true
          name: platform_name
          schema:
            type: string
      responses:
        200:
          description: Get a jsonschema template for a segment
          content:
            application/json:
              schema:
                type: object
                required:
                  - active
                  - response
                properties:
                  active:
                    type: boolean
                  response:
                    type: object
        400:
          $ref: '#/components/responses/BadRequest'
  /performances/report:
    post:
      operationId: stratus_api.integrations.routes.v1.performances.download_performance_report_request
      description: pulls performance report and uploads it to Google Cloud Storage
      tags:
        - performance
      security:
        - oauth2:
            - post:performances/report
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - destination
                - platform_name
              properties:
                platform_name:
                  type: string
                destination:
                  type: object
                  required:
                    - account_uuid
                    - product_uuid
                    - destination_uuid
                    - settings
                    - external_attributes
                    - external_id
                  properties:
                    destination_uuid:
                      type: string
                      example: '8fb1d425-a5be-2fd5-738d-089805c50c56'
                    account_uuid:
                      type: string
                      example: '1001d425-7890-2346-2345-100105c10001'
                    product_uuid:
                      type: string
                      example: 'b4209872-738d-a5be-2346-8fb1d4252345'
                    settings:
                      type: object
                    external_id:
                      type: string
                    external_attributes:
                      type: object
      responses:
        204:
          description: Performance pull triggered

        400:
          $ref: '#/components/responses/BadRequest'
  /settings:
    get:
      operationId: stratus_api.integrations.routes.v1.settings.get_settings_request
      security:
        - oauth2:
            - get:settings
      responses:
        200:
          description: returns what you send
          content:
            application/json:
              schema:
                type: object
                required:
                  - active
                  - response
                properties:
                  active:
                    type: boolean
                  response:
                    type: object
        400:
          $ref: '#/components/responses/BadRequest'
  /distribution:
    post:
      operationId: stratus_api.integrations.routes.v1.distribution.distribute_file_request
      security:
        - oauth2:
            - post:distribution
      requestBody:
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              required:
                - platform_name
                - destination
                - segments
                - bucket_name
                - file_pattern
                - file_headers
              properties:
                platform_name:
                  type: string
                destination:
                  $ref: '#/components/schemas/Destination'
                segments:
                  type: array
                  minItems: 1
                  items:
                    $ref: '#/components/schemas/Segment'
                id_types:
                  type: array
                  items:
                    type: string
                operations:
                  type: array
                  items:
                    type: string
                    enum:
                      - add
                      - remove
                bucket_name:
                  type: string
                file_pattern:
                  type: string
                file_headers:
                  type: array
                  example: ["user_id", "id_type", "external_id", "d933db58-9bb2-498a-b60a-2b36ebb0e875"]
                  items:
                    type: string

      responses:
        200:
          description: request acknowledged
          content:
            application/json:
              schema:
                type: object
                properties:
                  active:
                    type: boolean
                  response:
                    type: object
                    properties:
                      job_uuid:
                        type: string
        400:
          $ref: '#/components/responses/BadRequest'
components:
  responses:
    BadRequest:
      description: Invalid request format
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
                example: Request Missing Required Field
              status:
                type: integer
                example: 400
              title:
                type: string
                example: Bad Request
              type:
                type: string
                example: "about:blank"
    Unauthorized:
      description: Missing/Invalid/Expired Authorization Token
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string
                example: No authorization token provided
              status:
                type: integer
                example: 401
              title:
                type: string
                example: Unauthorized
              type:
                type: string
                example: "about:blank"
  schemas:
    Segment:
      type: object
      properties:
        name:
          type: string
        segment_uuid:
          type: string
        destination_uuid:
          type: string
        settings:
          type: object
        external_attributes:
          type: object
        external_id:
          type: string
    Destination:
      type: object
      properties:
        destination_uuid:
          type: string
        platform_uuid:
          type: string
        name:
          type: string
        settings:
          type: object
        external_attributes:
          type: object
        external_id:
          type: string
  securitySchemes:
    oauth2:
      type: oauth2
      x-tokenInfoFunc: stratus_api.auth.oauth.verify_token
      flows:
        clientCredentials:
          tokenUrl: /auth/v1/oauth/token