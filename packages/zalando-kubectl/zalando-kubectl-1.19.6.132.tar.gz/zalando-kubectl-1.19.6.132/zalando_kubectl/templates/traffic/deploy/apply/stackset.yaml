apiVersion: zalando.org/v1
kind: StackSet
metadata:
  name: "{{{APPLICATION}}}"
  labels:
    application: "{{{APPLICATION}}}"
spec:
  ingress:
    hosts:
    - {{{APPLICATION}}}.{{{CDP_TARGET_CLUSTER}}}.zalan.do
    backendPort: ingress
  stackLifecycle:
    scaledownTTLSeconds: 300
    limit: 5
  stackTemplate:
    spec:
      version: {{{CDP_BUILD_VERSION}}}
      replicas: {{{REPLICAS}}}
      podTemplate:
        spec:
          containers:
          - name: "{{{APPLICATION}}}"
            image: "{{{DEP_IMAGE_REF}}}:{{{DEP_IMAGE_VERSION}}}"
            ports:
            - containerPort: 8080
              name: ingress
            env:
              # for JVM applications: set the maximum available memory as JVM
              # would assume host/node capacity otherwise this is evaluated by
              # java-dynamic-memory-opts in the Zalando OpenJDK base image
              # see https://github.com/zalando/docker-openjdk
              - name: MEM_TOTAL_KB
                valueFrom:
                  resourceFieldRef:
                    resource: limits.memory
                    divisor: 1Ki
              # Used in this example. You can remove it when adapting it for your
              # project.
              - name: COLOR
                value: "{{{COLOR}}}"
            resources:
              requests:
                cpu: "5m"
                memory: "25Mi"
              limits:
                memory: "25Mi"
            readinessProbe:
              httpGet:
                path: /healthz
                port: 8080
